var e,t,i,n,s,r,o,a,l,h,u,d,c,p,f,g,m,w,y,A,v,V,b,x,E,S=Object.defineProperty,R=(e,t,i)=>((e,t,i)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var k=Object.defineProperty,T=(e,t)=>k(e,"name",{value:t,configurable:!0}),M=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:4*t-205]=t;return t=>{for(var i=t.length,n=new Uint8Array(3*(i-("="==t[i-1])-("="==t[i-2]))/4|0),s=0,r=0;s<i;){var o=e[t.charCodeAt(s++)],a=e[t.charCodeAt(s++)],l=e[t.charCodeAt(s++)],h=e[t.charCodeAt(s++)];n[r++]=o<<2|a>>4,n[r++]=a<<4|l>>2,n[r++]=l<<6|h}return n}})();function I(e){return e*Math.PI/180}function D(e){return 180*e/Math.PI}function P(e,t,i){return t>i?P(e,i,t):Math.min(Math.max(e,t),i)}function B(e,t,i){if("number"==typeof e&&"number"==typeof t)return e+(t-e)*i;if(e instanceof U&&t instanceof U)return e.lerp(t,i);if(e instanceof L&&t instanceof L)return e.lerp(t,i);throw new Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}function C(e,t,i,n,s){return n+(e-t)/(i-t)*(s-n)}function F(e,t,i,n,s){return P(C(e,t,i,n,s),n,s)}T(I,"deg2rad"),T(D,"rad2deg"),T(P,"clamp"),T(B,"lerp"),T(C,"map"),T(F,"mapc");var U=(T(e=class{constructor(e=0,t=e){R(this,"x",0),R(this,"y",0),this.x=e,this.y=t}static fromAngle(t){let i=I(t);return new e(Math.cos(i),Math.sin(i))}clone(){return new e(this.x,this.y)}add(...t){let i=N(...t);return new e(this.x+i.x,this.y+i.y)}sub(...t){let i=N(...t);return new e(this.x-i.x,this.y-i.y)}scale(...t){let i=N(...t);return new e(this.x*i.x,this.y*i.y)}dist(...e){let t=N(...e);return this.sub(t).len()}sdist(...e){let t=N(...e);return this.sub(t).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let t=this.len();return 0===t?new e(0):this.scale(1/t)}normal(){return new e(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let t=N(...e);return D(Math.atan2(this.y-t.y,this.x-t.x))}angleBetween(...e){let t=N(...e);return D(Math.atan2(this.cross(t),this.dot(t)))}lerp(t,i){return new e(B(this.x,t.x,i),B(this.y,t.y,i))}slerp(e,t){let i=this.dot(e),n=this.cross(e),s=Math.atan2(n,i);return this.scale(Math.sin((1-t)*s)).add(e.scale(Math.sin(t*s))).scale(1/n)}isZero(){return 0===this.x&&0===this.y}toFixed(t){return new e(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new ue(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}},"Vec2"),R(e,"LEFT",new e(-1,0)),R(e,"RIGHT",new e(1,0)),R(e,"UP",new e(0,-1)),R(e,"DOWN",new e(0,1)),e);function N(...e){if(1===e.length){if(e[0]instanceof U)return new U(e[0].x,e[0].y);if(Array.isArray(e[0])&&2===e[0].length)return new U(...e[0])}return new U(...e)}T(N,"vec2");var L=(t=class{constructor(e,t,i){R(this,"r",255),R(this,"g",255),R(this,"b",255),this.r=P(e,0,255),this.g=P(t,0,255),this.b=P(i,0,255)}static fromArray(e){return new t(e[0],e[1],e[2])}static fromHex(e){if("number"==typeof e)return new t(e>>16&255,e>>8&255,255&e);if("string"==typeof e){let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new t(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16))}throw new Error("Invalid hex color format")}static fromHSL(e,i,n){if(0==i)return new t(255*n,255*n,255*n);let s=T(((e,t,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e)),"hue2rgb"),r=n<.5?n*(1+i):n+i-n*i,o=2*n-r,a=s(o,r,e+1/3),l=s(o,r,e),h=s(o,r,e-1/3);return new t(Math.round(255*a),Math.round(255*l),Math.round(255*h))}clone(){return new t(this.r,this.g,this.b)}lighten(e){return new t(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new t(255-this.r,255-this.g,255-this.b)}mult(e){return new t(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,i){return new t(B(this.r,e.r,i),B(this.g,e.g,i),B(this.b,e.b,i))}toHSL(){let e=this.r/255,t=this.g/255,i=this.b/255,n=Math.max(e,t,i),s=Math.min(e,t,i),r=(n+s)/2,o=r,a=r;if(n==s)r=o=0;else{let l=n-s;switch(o=a>.5?l/(2-n-s):l/(n+s),n){case e:r=(t-i)/l+(t<i?6:0);break;case t:r=(i-e)/l+2;break;case i:r=(e-t)/l+4}r/=6}return[r,o,a]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}},T(t,"Color"),R(t,"RED",new t(255,0,0)),R(t,"GREEN",new t(0,255,0)),R(t,"BLUE",new t(0,0,255)),R(t,"YELLOW",new t(255,255,0)),R(t,"MAGENTA",new t(255,0,255)),R(t,"CYAN",new t(0,255,255)),R(t,"WHITE",new t(255,255,255)),R(t,"BLACK",new t(0,0,0)),t);function O(...e){if(0===e.length)return new L(255,255,255);if(1===e.length){if(e[0]instanceof L)return e[0].clone();if("string"==typeof e[0])return L.fromHex(e[0]);if(Array.isArray(e[0])&&3===e[0].length)return L.fromArray(e[0])}return new L(...e)}T(O,"rgb");var G=T(((e,t,i)=>L.fromHSL(e,t,i)),"hsl2rgb"),q=(T(i=class{constructor(e,t,i,n){R(this,"x",0),R(this,"y",0),R(this,"w",1),R(this,"h",1),this.x=e,this.y=t,this.w=i,this.h=n}scale(e){return new i(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new U(this.x,this.y)}clone(){return new i(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}},"Quad"),i);function K(e,t,i,n){return new q(e,t,i,n)}T(K,"quad");var j=(n=class{constructor(e){R(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),e&&(this.m=e)}static translate(e){return new n([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new n([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=I(-e);let t=Math.cos(e),i=Math.sin(e);return new n([1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1])}static rotateY(e){e=I(-e);let t=Math.cos(e),i=Math.sin(e);return new n([t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1])}static rotateZ(e){e=I(-e);let t=Math.cos(e),i=Math.sin(e);return new n([t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=I(-e);let t=Math.cos(e),i=Math.sin(e),n=this.m[0],s=this.m[1],r=this.m[4],o=this.m[5];return this.m[0]=n*t+s*i,this.m[1]=-n*i+s*t,this.m[4]=r*t+o*i,this.m[5]=-r*i+o*t,this}mult(e){let t=[];for(let i=0;i<4;i++)for(let n=0;n<4;n++)t[4*i+n]=this.m[0+n]*e.m[4*i+0]+this.m[4+n]*e.m[4*i+1]+this.m[8+n]*e.m[4*i+2]+this.m[12+n]*e.m[4*i+3];return new n(t)}multVec2(e){return new U(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new U(this.m[12],this.m[13])}getScale(){if(0!=this.m[0]||0!=this.m[1]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new U(t,e/t)}if(0!=this.m[4]||0!=this.m[5]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new U(e/t,t)}return new U(0,0)}getRotation(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return D(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return D(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}return 0}getSkew(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new U(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new U(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}return new U(0,0)}invert(){let e=[],t=this.m[10]*this.m[15]-this.m[14]*this.m[11],i=this.m[9]*this.m[15]-this.m[13]*this.m[11],s=this.m[9]*this.m[14]-this.m[13]*this.m[10],r=this.m[8]*this.m[15]-this.m[12]*this.m[11],o=this.m[8]*this.m[14]-this.m[12]*this.m[10],a=this.m[8]*this.m[13]-this.m[12]*this.m[9],l=this.m[6]*this.m[15]-this.m[14]*this.m[7],h=this.m[5]*this.m[15]-this.m[13]*this.m[7],u=this.m[5]*this.m[14]-this.m[13]*this.m[6],d=this.m[4]*this.m[15]-this.m[12]*this.m[7],c=this.m[4]*this.m[14]-this.m[12]*this.m[6],p=this.m[5]*this.m[15]-this.m[13]*this.m[7],f=this.m[4]*this.m[13]-this.m[12]*this.m[5],g=this.m[6]*this.m[11]-this.m[10]*this.m[7],m=this.m[5]*this.m[11]-this.m[9]*this.m[7],w=this.m[5]*this.m[10]-this.m[9]*this.m[6],y=this.m[4]*this.m[11]-this.m[8]*this.m[7],A=this.m[4]*this.m[10]-this.m[8]*this.m[6],v=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*t-this.m[6]*i+this.m[7]*s,e[4]=-(this.m[4]*t-this.m[6]*r+this.m[7]*o),e[8]=this.m[4]*i-this.m[5]*r+this.m[7]*a,e[12]=-(this.m[4]*s-this.m[5]*o+this.m[6]*a),e[1]=-(this.m[1]*t-this.m[2]*i+this.m[3]*s),e[5]=this.m[0]*t-this.m[2]*r+this.m[3]*o,e[9]=-(this.m[0]*i-this.m[1]*r+this.m[3]*a),e[13]=this.m[0]*s-this.m[1]*o+this.m[2]*a,e[2]=this.m[1]*l-this.m[2]*h+this.m[3]*u,e[6]=-(this.m[0]*l-this.m[2]*d+this.m[3]*c),e[10]=this.m[0]*p-this.m[1]*d+this.m[3]*f,e[14]=-(this.m[0]*u-this.m[1]*c+this.m[2]*f),e[3]=-(this.m[1]*g-this.m[2]*m+this.m[3]*w),e[7]=this.m[0]*g-this.m[2]*y+this.m[3]*A,e[11]=-(this.m[0]*m-this.m[1]*y+this.m[3]*v),e[15]=this.m[0]*w-this.m[1]*A+this.m[2]*v;let V=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let n=0;n<4;n++)for(let t=0;t<4;t++)e[4*n+t]*=1/V;return new n(e)}clone(){return new n([...this.m])}toString(){return this.m.toString()}},T(n,"Mat4"),n);function H(e,t,i,n=e=>-Math.cos(e)){return e+(n(i)+1)/2*(t-e)}T(H,"wave");var Y=2147483648,z=(T(s=class{constructor(e){R(this,"seed"),this.seed=e}gen(){return this.seed=(1103515245*this.seed+12345)%Y,this.seed/Y}genNumber(e,t){return e+this.gen()*(t-e)}genVec2(e,t){return new U(this.genNumber(e.x,t.x),this.genNumber(e.y,t.y))}genColor(e,t){return new L(this.genNumber(e.r,t.r),this.genNumber(e.g,t.g),this.genNumber(e.b,t.b))}genAny(...e){if(0===e.length)return this.gen();if(1===e.length){if("number"==typeof e[0])return this.genNumber(0,e[0]);if(e[0]instanceof U)return this.genVec2(N(0,0),e[0]);if(e[0]instanceof L)return this.genColor(O(0,0,0),e[0])}else if(2===e.length){if("number"==typeof e[0]&&"number"==typeof e[1])return this.genNumber(e[0],e[1]);if(e[0]instanceof U&&e[1]instanceof U)return this.genVec2(e[0],e[1]);if(e[0]instanceof L&&e[1]instanceof L)return this.genColor(e[0],e[1])}}},"RNG"),s),Q=new z(Date.now());function X(e){return null!=e&&(Q.seed=e),Q.seed}function J(...e){return Q.genAny(...e)}function W(...e){return Math.floor(J(...e))}function Z(e){return J()<=e}function _(e){return e[W(e.length)]}function $(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}function ee(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let i=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(0===i)return null;let n=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/i,s=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/i;return n<0||n>1||s<0||s>1?null:n}function te(e,t){let i=ee(e,t);return i?N(e.p1.x+i*(e.p2.x-e.p1.x),e.p1.y+i*(e.p2.y-e.p1.y)):null}function ie(e,t){if(ne(e,t.p1)||ne(e,t.p2))return!0;let i=e.points();return!!(te(t,new he(i[0],i[1]))||te(t,new he(i[1],i[2]))||te(t,new he(i[2],i[3]))||te(t,new he(i[3],i[0])))}function ne(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}function se(e,t){let i=t.sub(e.p1),n=e.p2.sub(e.p1);if(Math.abs(i.cross(n))>Number.EPSILON)return!1;let s=i.dot(n)/n.dot(n);return s>=0&&s<=1}function re(e,t){let i=e.p2.sub(e.p1),n=i.dot(i),s=e.p1.sub(t.center),r=2*i.dot(s),o=r*r-4*n*(s.dot(s)-t.radius*t.radius);if(n<=Number.EPSILON||o<0)return!1;if(0==o){let e=-r/(2*n);if(e>=0&&e<=1)return!0}else{let e=(-r+Math.sqrt(o))/(2*n),t=(-r-Math.sqrt(o))/(2*n);if(e>=0&&e<=1||t>=0&&t<=1)return!0}return oe(t,e.p1)}function oe(e,t){return e.center.sdist(t)<e.radius*e.radius}function ae(e,t){let i=t.pts[t.pts.length-1];for(let n of t.pts){if(re(new he(i,n),e))return!0;i=n}return!!oe(e,t.pts[0])||le(t,e.center)}function le(e,t){let i=!1,n=e.pts;for(let s=0,r=n.length-1;s<n.length;r=s++)n[s].y>t.y!=n[r].y>t.y&&t.x<(n[r].x-n[s].x)*(t.y-n[s].y)/(n[r].y-n[s].y)+n[s].x&&(i=!i);return i}T(X,"randSeed"),T(J,"rand"),T(W,"randi"),T(Z,"chance"),T(_,"choose"),T($,"testRectRect"),T(ee,"testLineLineT"),T(te,"testLineLine"),T(ie,"testRectLine"),T(ne,"testRectPoint"),T(se,"testLinePoint"),T(re,"testLineCircle"),T(oe,"testCirclePoint"),T(ae,"testCirclePolygon"),T(le,"testPolygonPoint");var he=(T(r=class{constructor(e,t){R(this,"p1"),R(this,"p2"),this.p1=e.clone(),this.p2=t.clone()}transform(e){return new r(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return ue.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new r(this.p1,this.p2)}},"Line"),r),ue=(T(o=class{constructor(e,t,i){R(this,"pos"),R(this,"width"),R(this,"height"),this.pos=e.clone(),this.width=t,this.height=i}static fromPoints(e,t){return new o(e.clone(),t.x-e.x,t.y-e.y)}center(){return new U(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new pe(this.points().map((t=>e.multVec2(t))))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new o(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let t=this.pos,i=this.pos.add(this.width,this.height),n=Math.max(t.x-e.x,0,e.x-i.x),s=Math.max(t.y-e.y,0,e.y-i.y);return n*n+s*s}},"Rect"),o),de=(T(a=class{constructor(e,t){R(this,"center"),R(this,"radius"),this.center=e.clone(),this.radius=t}transform(e){return new ce(this.center,this.radius,this.radius).transform(e)}bbox(){return ue.fromPoints(this.center.sub(N(this.radius)),this.center.add(N(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new a(this.center,this.radius)}},"Circle"),a),ce=(T(l=class{constructor(e,t,i){R(this,"center"),R(this,"radiusX"),R(this,"radiusY"),this.center=e.clone(),this.radiusX=t,this.radiusY=i}transform(e){return new l(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY)}bbox(){return ue.fromPoints(this.center.sub(N(this.radiusX,this.radiusY)),this.center.add(N(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new l(this.center,this.radiusX,this.radiusY)}},"Ellipse"),l),pe=(T(h=class{constructor(e){if(R(this,"pts"),e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new h(this.pts.map((t=>e.multVec2(t))))}bbox(){let e=N(Number.MAX_VALUE),t=N(-Number.MAX_VALUE);for(let i of this.pts)e.x=Math.min(e.x,i.x),t.x=Math.max(t.x,i.x),e.y=Math.min(e.y,i.y),t.y=Math.max(t.y,i.y);return ue.fromPoints(e,t)}area(){let e=0,t=this.pts.length;for(let i=0;i<t;i++){let n=this.pts[i],s=this.pts[(i+1)%t];e+=n.x*s.y*.5,e-=s.x*n.y*.5}return Math.abs(e)}clone(){return new h(this.pts.map((e=>e.clone())))}},"Polygon"),h);function fe(e,t){let i=Number.MAX_VALUE,n=N(0);for(let s of[e,t])for(let r=0;r<s.pts.length;r++){let o=s.pts[r],a=s.pts[(r+1)%s.pts.length].sub(o).normal().unit(),l=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let t=0;t<e.pts.length;t++){let i=e.pts[t].dot(a);l=Math.min(l,i),h=Math.max(h,i)}let u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let e=0;e<t.pts.length;e++){let i=t.pts[e].dot(a);u=Math.min(u,i),d=Math.max(d,i)}let c=Math.min(h,d)-Math.max(l,u);if(c<0)return null;if(c<Math.abs(i)){let e=d-l,t=u-h;i=Math.abs(e)<Math.abs(t)?e:t,n=a.scale(i)}}return n}T(fe,"sat");var ge=(u=class extends Map{constructor(...e){super(...e),R(this,"lastID"),this.lastID=0}push(e){let t=this.lastID;return this.set(t,e),this.lastID++,t}pushd(e){let t=this.push(e);return()=>this.delete(t)}},T(u,"Registry"),u),me=(T(d=class{constructor(e){R(this,"paused",!1),R(this,"cancel"),this.cancel=e}static join(e){let t=new d((()=>e.forEach((e=>e.cancel()))));return Object.defineProperty(t,"paused",{get:()=>e[0].paused,set:t=>e.forEach((e=>e.paused=t))}),t.paused=!1,t}},"EventController"),d),we=(T(c=class{constructor(){R(this,"handlers",new ge)}add(e){let t=this.handlers.pushd(((...t)=>{i.paused||e(...t)})),i=new me(t);return i}addOnce(e){let t=this.add(((...i)=>{t.cancel(),e(...i)}));return t}next(){return new Promise((e=>this.addOnce(e)))}trigger(...e){this.handlers.forEach((t=>t(...e)))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},"Event"),c),ye=(T(p=class{constructor(){R(this,"handlers",{})}on(e,t){return this.handlers[e]||(this.handlers[e]=new we),this.handlers[e].add(t)}onOnce(e,t){let i=this.on(e,((...e)=>{i.cancel(),t(...e)}));return i}next(e){return new Promise((t=>{this.onOnce(e,((...e)=>t(e[0])))}))}trigger(e,...t){this.handlers[e]&&this.handlers[e].trigger(...t)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){var t;return(null==(t=this.handlers[e])?void 0:t.numListeners())??0}},"EventHandler"),p);function Ae(e,t){if(e===t)return!0;let i=typeof e,n=typeof t;if(i!==n)return!1;if("object"===i&&"object"===n&&null!==e&&null!==t){if(Array.isArray(e)!==Array.isArray(t))return!1;let i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(let s of i){if(!Ae(e[s],t[s]))return!1}return!0}return!1}function ve(e){let t=window.atob(e),i=t.length,n=new Uint8Array(i);for(let s=0;s<i;s++)n[s]=t.charCodeAt(s);return n.buffer}function Ve(e){return ve(e.split(",")[1])}function be(e,t){let i=document.createElement("a");i.href=t,i.download=e,i.click()}function xe(e,t){be(e,"data:text/plain;charset=utf-8,"+t)}function Ee(e,t){xe(e,JSON.stringify(t))}function Se(e,t){let i=URL.createObjectURL(t);be(e,i),URL.revokeObjectURL(i)}T(Ae,"deepEq"),T(ve,"base64ToArrayBuffer"),T(Ve,"dataURLToArrayBuffer"),T(be,"download"),T(xe,"downloadText"),T(Ee,"downloadJSON"),T(Se,"downloadBlob");var Re=T((e=>e.match(/^data:\w+\/\w+;base64,.+/)),"isDataURL"),ke=T((e=>e.split(".").slice(0,-1).join(".")),"getFileName");function Te(e,t){return(...i)=>{let n=i.length;return n===e.length?e(...i):n===t.length?t(...i):void 0}}T(Te,"overload2");var Me=(()=>{let e=0;return()=>e++})(),Ie=T((e=>e instanceof Error?e.message:String(e)),"getErrorMessage"),De=(T(f=class{constructor(e=(e,t)=>e<t){R(this,"_items"),R(this,"_compareFn"),this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(0===this._items.length)return null;let e=this._items[0],t=this._items.pop();return 0!==this._items.length&&(this._items[0]=t,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let t=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[t])&&this._items[e]>=this._items[t])break;this.swap(e,t),e=t}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let t=2*e+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[e],this._items[t]))break;this.swap(e,t),e=t}}swap(e,t){[this._items[e],this._items[t]]=[this._items[t],this._items[e]]}get length(){return this._items.length}},"BinaryHeap"),f),Pe=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Be(e){if("string"!=typeof e)throw new TypeError("string cannot be undefined or null");let t=[],i=0,n=0;for(;i<e.length;)n+=Ce(i+n,e),Ke(e[i+n])&&n++,Oe(e[i+n])&&n++,Ge(e[i+n])&&n++,je(e[i+n])?n++:(t.push(e.substring(i,i+n)),i+=n,n=0);return t}function Ce(e,t){let i=t[e];if(!Fe(i)||e===t.length-1)return 1;let n=i+t[e+1],s=t.substring(e+2,e+5);return Ue(n)&&Ue(s)?4:Ne(n)&&qe(s)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:Le(s)?4:2}function Fe(e){return e&&Ye(e[0].charCodeAt(0),55296,56319)}function Ue(e){return Ye(He(e),127462,127487)}function Ne(e){return Ye(He(e),127988,127988)}function Le(e){return Ye(He(e),127995,127999)}function Oe(e){return"string"==typeof e&&Ye(e.charCodeAt(0),65024,65039)}function Ge(e){return"string"==typeof e&&Ye(e.charCodeAt(0),8400,8447)}function qe(e){let t=e.codePointAt(0);return"string"==typeof e&&"number"==typeof t&&Ye(t,917504,917631)}function Ke(e){return"string"==typeof e&&Pe.includes(e.charCodeAt(0))}function je(e){return"string"==typeof e&&8205===e.charCodeAt(0)}function He(e){return(e.charCodeAt(0)-55296<<10)+(e.charCodeAt(1)-56320)+65536}function Ye(e,t,i){return e>=t&&e<=i}T(Be,"runes"),T(Ce,"nextUnits"),T(Fe,"isFirstOfSurrogatePair"),T(Ue,"isRegionalIndicator"),T(Ne,"isSubdivisionFlag"),T(Le,"isFitzpatrickModifier"),T(Oe,"isVariationSelector"),T(Ge,"isDiacriticalMark"),T(qe,"isSupplementarySpecialpurposePlane"),T(Ke,"isGrapheme"),T(je,"isZeroWidthJoiner"),T(He,"codePointFromSurrogatePair"),T(Ye,"betweenInclusive");var ze={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},Qe=(T(g=class{constructor(){R(this,"pressed",new Set([])),R(this,"pressedRepeat",new Set([])),R(this,"released",new Set([])),R(this,"down",new Set([]))}update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},"ButtonState"),g),Xe=(T(m=class{constructor(){R(this,"buttonState",new Qe),R(this,"stickState",new Map)}},"GamepadState"),m),Je=(T(w=class{constructor(){R(this,"dts",[]),R(this,"timer",0),R(this,"fps",0)}tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce(((e,t)=>e+t))/this.dts.length)),this.dts=[])}},"FPSCounter"),w),We=T((e=>{if(!e.canvas)throw new Error("Please provide a canvas");let t={canvas:e.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new Je,timeScale:1,skipTime:!1,numFrames:0,mousePos:new U(0),mouseDeltaPos:new U(0),keyState:new Qe,mouseState:new Qe,mergedGamepadState:new Xe,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new ye};function i(){return t.dt*t.timeScale}function n(){return t.time}function s(){return t.fpsCounter.fps}function r(){return t.numFrames}function o(){return t.canvas.toDataURL()}function a(e){t.canvas.style.cursor=e}function l(){return t.canvas.style.cursor}function h(e){if(e)try{let e=t.canvas.requestPointerLock();e.catch&&e.catch((e=>console.error(e)))}catch(i){console.error(i)}else document.exitPointerLock()}function u(){return!!document.pointerLockElement}function d(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function c(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function p(){return document.fullscreenElement||document.webkitFullscreenElement}function f(e=!0){e?d(t.canvas):c()}function g(){return!!p()}function m(){t.stopped=!0;for(let e in de)t.canvas.removeEventListener(e,de[e]);for(let e in ce)document.removeEventListener(e,ce[e]);for(let e in pe)window.removeEventListener(e,pe[e]);Ae.disconnect()}function w(n){null!==t.loopID&&cancelAnimationFrame(t.loopID);let s=0,r=T((o=>{if(t.stopped)return;if("visible"!==document.visibilityState)return void(t.loopID=requestAnimationFrame(r));let a=o/1e3,l=a-t.realTime,h=e.maxFPS?1/e.maxFPS:0;t.realTime=a,s+=l,s>h&&(t.skipTime||(t.dt=s,t.time+=i(),t.fpsCounter.tick(t.dt)),s=0,t.skipTime=!1,t.numFrames++,oe(),n(),ae()),t.loopID=requestAnimationFrame(r)}),"frame");r(0)}function y(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function A(){return t.mousePos.clone()}function v(){return t.mouseDeltaPos.clone()}function V(e="left"){return t.mouseState.pressed.has(e)}function b(e="left"){return t.mouseState.down.has(e)}function x(e="left"){return t.mouseState.released.has(e)}function E(){return t.isMouseMoved}function S(e){return void 0===e?t.keyState.pressed.size>0:t.keyState.pressed.has(e)}function R(e){return void 0===e?t.keyState.pressedRepeat.size>0:t.keyState.pressedRepeat.has(e)}function k(e){return void 0===e?t.keyState.down.size>0:t.keyState.down.has(e)}function M(e){return void 0===e?t.keyState.released.size>0:t.keyState.released.has(e)}function I(e){return void 0===e?t.mergedGamepadState.buttonState.pressed.size>0:t.mergedGamepadState.buttonState.pressed.has(e)}function D(e){return void 0===e?t.mergedGamepadState.buttonState.down.size>0:t.mergedGamepadState.buttonState.down.has(e)}function P(e){return void 0===e?t.mergedGamepadState.buttonState.released.size>0:t.mergedGamepadState.buttonState.released.has(e)}function B(e){return t.events.on("resize",e)}T(i,"dt"),T(n,"time"),T(s,"fps"),T(r,"numFrames"),T(o,"screenshot"),T(a,"setCursor"),T(l,"getCursor"),T(h,"setCursorLocked"),T(u,"isCursorLocked"),T(d,"enterFullscreen"),T(c,"exitFullscreen"),T(p,"getFullscreenElement"),T(f,"setFullscreen"),T(g,"isFullscreen"),T(m,"quit"),T(w,"run"),T(y,"isTouchscreen"),T(A,"mousePos"),T(v,"mouseDeltaPos"),T(V,"isMousePressed"),T(b,"isMouseDown"),T(x,"isMouseReleased"),T(E,"isMouseMoved"),T(S,"isKeyPressed"),T(R,"isKeyPressedRepeat"),T(k,"isKeyDown"),T(M,"isKeyReleased"),T(I,"isGamepadButtonPressed"),T(D,"isGamepadButtonDown"),T(P,"isGamepadButtonReleased"),T(B,"onResize");let F=Te((e=>t.events.on("keyDown",e)),((e,i)=>t.events.on("keyDown",(t=>t===e&&i(e))))),N=Te((e=>t.events.on("keyPress",e)),((e,i)=>t.events.on("keyPress",(t=>t===e&&i(e))))),L=Te((e=>t.events.on("keyPressRepeat",e)),((e,i)=>t.events.on("keyPressRepeat",(t=>t===e&&i(e))))),O=Te((e=>t.events.on("keyRelease",e)),((e,i)=>t.events.on("keyRelease",(t=>t===e&&i(e))))),G=Te((e=>t.events.on("mouseDown",(t=>e(t)))),((e,i)=>t.events.on("mouseDown",(t=>t===e&&i(t))))),q=Te((e=>t.events.on("mousePress",(t=>e(t)))),((e,i)=>t.events.on("mousePress",(t=>t===e&&i(t))))),K=Te((e=>t.events.on("mouseRelease",(t=>e(t)))),((e,i)=>t.events.on("mouseRelease",(t=>t===e&&i(t)))));function j(e){return t.events.on("mouseMove",(()=>e(A(),v())))}function H(e){return t.events.on("charInput",e)}function Y(e){return t.events.on("touchStart",e)}function z(e){return t.events.on("touchMove",e)}function Q(e){return t.events.on("touchEnd",e)}function X(e){return t.events.on("scroll",e)}function J(e){return t.events.on("hide",e)}function W(e){return t.events.on("show",e)}function Z(e,i){return"function"==typeof e?t.events.on("gamepadButtonDown",e):"string"==typeof e&&"function"==typeof i?t.events.on("gamepadButtonDown",(t=>t===e&&i(e))):void 0}function _(e,i){return"function"==typeof e?t.events.on("gamepadButtonPress",e):"string"==typeof e&&"function"==typeof i?t.events.on("gamepadButtonPress",(t=>t===e&&i(e))):void 0}function $(e,i){return"function"==typeof e?t.events.on("gamepadButtonRelease",e):"string"==typeof e&&"function"==typeof i?t.events.on("gamepadButtonRelease",(t=>t===e&&i(e))):void 0}function ee(e,i){return t.events.on("gamepadStick",((t,n)=>t===e&&i(n)))}function te(e){t.events.on("gamepadConnect",e)}function ie(e){t.events.on("gamepadDisconnect",e)}function ne(e){return t.mergedGamepadState.stickState.get(e)||new U(0)}function se(){return[...t.charInputted]}function re(){return[...t.gamepads]}function oe(){t.events.trigger("input"),t.keyState.down.forEach((e=>t.events.trigger("keyDown",e))),t.mouseState.down.forEach((e=>t.events.trigger("mouseDown",e))),ue()}function ae(){t.keyState.update(),t.mouseState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach(((e,i)=>{t.mergedGamepadState.stickState.set(i,new U(0))})),t.charInputted=[],t.isMouseMoved=!1,t.gamepadStates.forEach((e=>{e.buttonState.update(),e.stickState.forEach(((t,i)=>{e.stickState.set(i,new U(0))}))}))}function le(e){let i={index:e.index,isPressed:i=>t.gamepadStates.get(e.index).buttonState.pressed.has(i),isDown:i=>t.gamepadStates.get(e.index).buttonState.down.has(i),isReleased:i=>t.gamepadStates.get(e.index).buttonState.released.has(i),getStick:i=>t.gamepadStates.get(e.index).stickState.get(i)};return t.gamepads.push(i),t.gamepadStates.set(e.index,{buttonState:new Qe,stickState:new Map([["left",new U(0)],["right",new U(0)]])}),i}function he(e){t.gamepads=t.gamepads.filter((t=>t.index!==e.index)),t.gamepadStates.delete(e.index)}function ue(){for(let e of navigator.getGamepads())e&&!t.gamepadStates.has(e.index)&&le(e);for(let i of t.gamepads){let n=navigator.getGamepads()[i.index],s=(e.gamepads??{})[n.id]??ze[n.id]??ze.default,r=t.gamepadStates.get(i.index);for(let e=0;e<n.buttons.length;e++)n.buttons[e].pressed?(r.buttonState.down.has(s.buttons[e])||(t.mergedGamepadState.buttonState.press(s.buttons[e]),r.buttonState.press(s.buttons[e]),t.events.trigger("gamepadButtonPress",s.buttons[e])),t.events.trigger("gamepadButtonDown",s.buttons[e])):r.buttonState.down.has(s.buttons[e])&&(t.mergedGamepadState.buttonState.release(s.buttons[e]),r.buttonState.release(s.buttons[e]),t.events.trigger("gamepadButtonRelease",s.buttons[e]));for(let e in s.sticks){let i=s.sticks[e],o=new U(n.axes[i.x],n.axes[i.y]);r.stickState.set(e,o),t.mergedGamepadState.stickState.set(e,o),t.events.trigger("gamepadStick",e,o)}}}T(j,"onMouseMove"),T(H,"onCharInput"),T(Y,"onTouchStart"),T(z,"onTouchMove"),T(Q,"onTouchEnd"),T(X,"onScroll"),T(J,"onHide"),T(W,"onShow"),T(Z,"onGamepadButtonDown"),T(_,"onGamepadButtonPress"),T($,"onGamepadButtonRelease"),T(ee,"onGamepadStick"),T(te,"onGamepadConnect"),T(ie,"onGamepadDisconnect"),T(ne,"getGamepadStick"),T(se,"charInputted"),T(re,"getGamepads"),T(oe,"processInput"),T(ae,"resetInput"),T(le,"registerGamepad"),T(he,"removeGamepad"),T(ue,"processGamepad");let de={},ce={},pe={},fe=e.pixelDensity||window.devicePixelRatio||1;de.mousemove=e=>{let i=new U(e.offsetX,e.offsetY),n=new U(e.movementX,e.movementY);if(g()){let n=t.canvas.width/fe,s=t.canvas.height/fe,r=window.innerWidth,o=window.innerHeight;if(r/o>n/s){let t=o/s,a=(r-n*t)/2;i.x=C(e.offsetX-a,0,n*t,0,n),i.y=C(e.offsetY,0,s*t,0,s)}else{let t=r/n,a=(o-s*t)/2;i.x=C(e.offsetX,0,n*t,0,n),i.y=C(e.offsetY-a,0,s*t,0,s)}}t.events.onOnce("input",(()=>{t.isMouseMoved=!0,t.mousePos=i,t.mouseDeltaPos=n,t.events.trigger("mouseMove")}))};let ge=["left","middle","right","back","forward"];de.mousedown=e=>{t.events.onOnce("input",(()=>{let i=ge[e.button];i&&(t.mouseState.press(i),t.events.trigger("mousePress",i))}))},de.mouseup=e=>{t.events.onOnce("input",(()=>{let i=ge[e.button];i&&(t.mouseState.release(i),t.events.trigger("mouseRelease",i))}))};let me=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),we={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};de.keydown=e=>{me.has(e.key)&&e.preventDefault(),t.events.onOnce("input",(()=>{let i=we[e.key]||e.key.toLowerCase();1===i.length?(t.events.trigger("charInput",i),t.charInputted.push(i)):"space"===i&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),e.repeat?(t.keyState.pressRepeat(i),t.events.trigger("keyPressRepeat",i)):(t.keyState.press(i),t.events.trigger("keyPressRepeat",i),t.events.trigger("keyPress",i))}))},de.keyup=e=>{t.events.onOnce("input",(()=>{let i=we[e.key]||e.key.toLowerCase();t.keyState.release(i),t.events.trigger("keyRelease",i)}))},de.touchstart=i=>{i.preventDefault(),t.events.onOnce("input",(()=>{let n=[...i.changedTouches],s=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new U(n[0].clientX-s.x,n[0].clientY-s.y),t.mouseState.press("left"),t.events.trigger("mousePress","left")),n.forEach((e=>{t.events.trigger("touchStart",new U(e.clientX-s.x,e.clientY-s.y),e)}))}))},de.touchmove=i=>{i.preventDefault(),t.events.onOnce("input",(()=>{let n=[...i.changedTouches],s=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new U(n[0].clientX-s.x,n[0].clientY-s.y),t.events.trigger("mouseMove")),n.forEach((e=>{t.events.trigger("touchMove",new U(e.clientX-s.x,e.clientY-s.y),e)}))}))},de.touchend=i=>{t.events.onOnce("input",(()=>{let n=[...i.changedTouches],s=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new U(n[0].clientX-s.x,n[0].clientY-s.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),n.forEach((e=>{t.events.trigger("touchEnd",new U(e.clientX-s.x,e.clientY-s.y),e)}))}))},de.touchcancel=i=>{t.events.onOnce("input",(()=>{let n=[...i.changedTouches],s=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new U(n[0].clientX-s.x,n[0].clientY-s.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),n.forEach((e=>{t.events.trigger("touchEnd",new U(e.clientX-s.x,e.clientY-s.y),e)}))}))},de.wheel=e=>{e.preventDefault(),t.events.onOnce("input",(()=>{t.events.trigger("scroll",new U(e.deltaX,e.deltaY))}))},de.contextmenu=e=>e.preventDefault(),ce.visibilitychange=()=>{"visible"===document.visibilityState?(t.skipTime=!0,t.events.trigger("show")):t.events.trigger("hide")},pe.gamepadconnected=e=>{let i=le(e.gamepad);t.events.onOnce("input",(()=>{t.events.trigger("gamepadConnect",i)}))},pe.gamepaddisconnected=e=>{let i=re().filter((t=>t.index===e.gamepad.index))[0];he(e.gamepad),t.events.onOnce("input",(()=>{t.events.trigger("gamepadDisconnect",i)}))};for(let T in de)t.canvas.addEventListener(T,de[T]);for(let T in ce)document.addEventListener(T,ce[T]);for(let T in pe)window.addEventListener(T,pe[T]);let Ae=new ResizeObserver((e=>{for(let i of e)if(i.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",(()=>{t.events.trigger("resize")}))}}));return Ae.observe(t.canvas),{dt:i,time:n,run:w,canvas:t.canvas,fps:s,numFrames:r,quit:m,setFullscreen:f,isFullscreen:g,setCursor:a,screenshot:o,getGamepads:re,getCursor:l,setCursorLocked:h,isCursorLocked:u,isTouchscreen:y,mousePos:A,mouseDeltaPos:v,isKeyDown:k,isKeyPressed:S,isKeyPressedRepeat:R,isKeyReleased:M,isMouseDown:b,isMousePressed:V,isMouseReleased:x,isMouseMoved:E,isGamepadButtonPressed:I,isGamepadButtonDown:D,isGamepadButtonReleased:P,getGamepadStick:ne,charInputted:se,onResize:B,onKeyDown:F,onKeyPress:N,onKeyPressRepeat:L,onKeyRelease:O,onMouseDown:G,onMousePress:q,onMouseRelease:K,onMouseMove:j,onCharInput:H,onTouchStart:Y,onTouchMove:z,onTouchEnd:Q,onScroll:X,onHide:J,onShow:W,onGamepadButtonDown:Z,onGamepadButtonPress:_,onGamepadButtonRelease:$,onGamepadStick:ee,onGamepadConnect:te,onGamepadDisconnect:ie,events:t.events}}),"default"),Ze=(T(y=class{constructor(e,t,i,n={}){R(this,"ctx"),R(this,"src",null),R(this,"glTex"),R(this,"width"),R(this,"height"),this.ctx=e;let s=e.gl;this.glTex=e.gl.createTexture(),e.onDestroy((()=>this.free())),this.width=t,this.height=i;let r={linear:s.LINEAR,nearest:s.NEAREST}[n.filter??e.opts.texFilter]??s.NEAREST,o={repeat:s.REPEAT,clampToEadge:s.CLAMP_TO_EDGE}[n.wrap]??s.CLAMP_TO_EDGE;this.bind(),t&&i&&s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,i,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,o),this.unbind()}static fromImage(e,t,i={}){let n=new y(e,t.width,t.height,i);return n.update(t),n.src=t,n}update(e,t=0,i=0){let n=this.ctx.gl;this.bind(),n.texSubImage2D(n.TEXTURE_2D,0,t,i,n.RGBA,n.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},"Texture"),y),_e=(T(A=class{constructor(e,t,i,n={}){R(this,"ctx"),R(this,"tex"),R(this,"glFramebuffer"),R(this,"glRenderbuffer"),this.ctx=e;let s=e.gl;e.onDestroy((()=>this.free())),this.tex=new Ze(e,t,i,n),this.glFramebuffer=s.createFramebuffer(),this.glRenderbuffer=s.createRenderbuffer(),this.bind(),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,t,i),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.tex.glTex,0),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,t=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,t),this.unbind();let i=4*this.width,n=new Uint8Array(i);for(let s=0;s<(this.height/2|0);s++){let e=s*i,r=(this.height-s-1)*i;n.set(t.subarray(e,e+i)),t.copyWithin(e,r,r+i),t.set(n,r)}return new ImageData(t,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this.width,e.height=this.height,t.putImageData(this.toImageData(),0,0),e.toDataURL()}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},"FrameBuffer"),A),$e=(T(v=class{constructor(e,t,i,n){R(this,"ctx"),R(this,"glProgram"),this.ctx=e,e.onDestroy((()=>this.free()));let s=e.gl,r=s.createShader(s.VERTEX_SHADER),o=s.createShader(s.FRAGMENT_SHADER);s.shaderSource(r,t),s.shaderSource(o,i),s.compileShader(r),s.compileShader(o);let a=s.createProgram();if(this.glProgram=a,s.attachShader(a,r),s.attachShader(a,o),n.forEach(((e,t)=>s.bindAttribLocation(a,t,e))),s.linkProgram(a),!s.getProgramParameter(a,s.LINK_STATUS)){let e=s.getShaderInfoLog(r);if(e)throw new Error("VERTEX SHADER "+e);let t=s.getShaderInfoLog(o);if(t)throw new Error("FRAGMENT SHADER "+t)}s.deleteShader(r),s.deleteShader(o)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let t=this.ctx.gl;for(let i in e){let n=e[i],s=t.getUniformLocation(this.glProgram,i);"number"==typeof n?t.uniform1f(s,n):n instanceof j?t.uniformMatrix4fv(s,!1,new Float32Array(n.m)):n instanceof L?t.uniform3f(s,n.r,n.g,n.b):n instanceof U&&t.uniform2f(s,n.x,n.y)}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},"Shader"),v),et=(T(V=class{constructor(e,t,i,n){R(this,"ctx"),R(this,"glVBuf"),R(this,"glIBuf"),R(this,"vqueue",[]),R(this,"iqueue",[]),R(this,"stride"),R(this,"maxVertices"),R(this,"maxIndices"),R(this,"vertexFormat"),R(this,"numDraws",0),R(this,"curPrimitive",null),R(this,"curTex",null),R(this,"curShader",null),R(this,"curUniform",{});let s=e.gl;this.vertexFormat=t,this.ctx=e,this.stride=t.reduce(((e,t)=>e+t.size),0),this.maxVertices=i,this.maxIndices=n,this.glVBuf=s.createBuffer(),e.pushArrayBuffer(this.glVBuf),s.bufferData(s.ARRAY_BUFFER,4*i,s.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=s.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),s.bufferData(s.ELEMENT_ARRAY_BUFFER,4*n,s.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,t,i,n,s=null,r={}){(e!==this.curPrimitive||s!==this.curTex||n!==this.curShader||!Ae(this.curUniform,r)||this.vqueue.length+t.length*this.stride>this.maxVertices||this.iqueue.length+i.length>this.maxIndices)&&this.flush();let o=this.vqueue.length/this.stride;for(let a of t)this.vqueue.push(a);for(let a of i)this.iqueue.push(a+o);this.curPrimitive=e,this.curShader=n,this.curTex=s,this.curUniform=r}flush(){var e,t;if(!this.curPrimitive||!this.curShader||0===this.vqueue.length||0===this.iqueue.length)return;let i=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),i.bufferSubData(i.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),null==(e=this.curTex)||e.bind(),i.drawElements(this.curPrimitive,this.iqueue.length,i.UNSIGNED_SHORT,0),null==(t=this.curTex)||t.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}},"BatchRenderer"),V);function tt(e){let t=[],i=T((i=>{t.push(i),e(i)}),"push"),n=T((()=>{t.pop(),e(s()??null)}),"pop"),s=T((()=>t[t.length-1]),"cur");return[i,n,s]}function it(e,t={}){let i=[];function n(e){i.push(e)}function s(){i.forEach((e=>e())),e.getExtension("WEBGL_lose_context").loseContext()}T(n,"onDestroy"),T(s,"destroy");let r=null;function o(t){if(Ae(t,r))return;r=t;let i=t.reduce(((e,t)=>e+t.size),0);t.reduce(((t,n,s)=>(e.vertexAttribPointer(s,n.size,e.FLOAT,!1,4*i,t),e.enableVertexAttribArray(s),t+4*n.size)),0)}T(o,"setVertexFormat");let[a,l]=tt((t=>e.bindTexture(e.TEXTURE_2D,t))),[h,u]=tt((t=>e.bindBuffer(e.ARRAY_BUFFER,t))),[d,c]=tt((t=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t))),[p,f]=tt((t=>e.bindFramebuffer(e.FRAMEBUFFER,t))),[g,m]=tt((t=>e.bindRenderbuffer(e.RENDERBUFFER,t))),[w,y]=tt((({x:t,y:i,w:n,h:s})=>{e.viewport(t,i,n,s)})),[A,v]=tt((t=>e.useProgram(t)));return w({x:0,y:0,w:e.drawingBufferWidth,h:e.drawingBufferHeight}),{gl:e,opts:t,onDestroy:n,destroy:s,pushTexture2D:a,popTexture2D:l,pushArrayBuffer:h,popArrayBuffer:u,pushElementArrayBuffer:d,popElementArrayBuffer:c,pushFramebuffer:p,popFramebuffer:f,pushRenderbuffer:g,popRenderbuffer:m,pushViewport:w,popViewport:y,pushProgram:A,popProgram:v,setVertexFormat:o}}T(tt,"genStack"),T(it,"initGfx");var nt=(T(b=class{constructor(e){R(this,"loaded",!1),R(this,"data",null),R(this,"error",null),R(this,"onLoadEvents",new we),R(this,"onErrorEvents",new we),R(this,"onFinishEvents",new we),e.then((e=>{this.data=e,this.onLoadEvents.trigger(e)})).catch((e=>{if(this.error=e,!(this.onErrorEvents.numListeners()>0))throw e;this.onErrorEvents.trigger(e)})).finally((()=>{this.onFinishEvents.trigger(),this.loaded=!0}))}static loaded(e){let t=new b(Promise.resolve(e));return t.data=e,t.loaded=!0,t}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},"Asset"),b),st=(T(x=class{constructor(){R(this,"assets",new Map),R(this,"lastUID",0)}add(e,t){let i=e??this.lastUID+++"",n=new nt(t);return this.assets.set(i,n),n}addLoaded(e,t){let i=e??this.lastUID+++"",n=nt.loaded(t);return this.assets.set(i,n),n}get(e){return this.assets.get(e)}progress(){if(0===this.assets.size)return 1;let e=0;return this.assets.forEach((t=>{t.loaded&&e++})),e/this.assets.size}},"AssetBucket"),x);function rt(e){return fetch(e).then((t=>{if(!t.ok)throw new Error(`Failed to fetch "${e}"`);return t}))}function ot(e){return rt(e).then((e=>e.json()))}function at(e){return rt(e).then((e=>e.text()))}function lt(e){return rt(e).then((e=>e.arrayBuffer()))}function ht(e){let t=new Image;return t.crossOrigin="anonymous",t.src=e,new Promise(((i,n)=>{t.onload=()=>i(t),t.onerror=()=>n(new Error(`Failed to load image from "${e}"`))}))}T(rt,"fetchURL"),T(ot,"fetchJSON"),T(at,"fetchText"),T(lt,"fetchArrayBuffer"),T(ht,"loadImg");var ut=2.5949095,dt=2.70158,ct=2*Math.PI/3,pt=2*Math.PI/4.5,ft={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>dt*e*e*e-1.70158*e*e,easeOutBack:e=>1+dt*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-ut)/2:(Math.pow(2*e-2,2)*((ut+1)*(2*e-2)+ut)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*ct),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*ct)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*pt)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*pt)/2+1,easeInBounce:e=>1-ft.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-ft.easeOutBounce(1-2*e))/2:(1+ft.easeOutBounce(2*e-1))/2},gt=ft,mt=(T(E=class{constructor(e,t,i){R(this,"textures",[]),R(this,"canvas"),R(this,"c2d"),R(this,"x",0),R(this,"y",0),R(this,"curHeight",0),R(this,"gfx"),this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=i,this.textures=[Ze.fromImage(e,this.canvas)],this.c2d=this.canvas.getContext("2d")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height)throw new Error(`Texture size (${e.width} x ${e.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(Ze.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let t=this.textures[this.textures.length-1],i=new U(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,i.x,i.y):this.c2d.drawImage(e,i.x,i.y),t.update(this.canvas),[t,new q(i.x/this.canvas.width,i.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free()}},"TexPacker"),E),wt=M("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),yt=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",At="topleft",vt="monospace",Vt=256,bt="linear",xt=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Et=8192*xt.reduce(((e,t)=>e+t.size),0),St="\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n",Rt="\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n",kt="\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n",Tt="\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n",Mt=new Set(["id","require"]),It=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function Dt(e){switch(e){case"topleft":return new U(-1,-1);case"top":return new U(0,-1);case"topright":return new U(1,-1);case"left":return new U(-1,0);case"center":return new U(0,0);case"right":return new U(1,0);case"botleft":return new U(-1,1);case"bot":return new U(0,1);case"botright":return new U(1,1);default:return e}}function Pt(e){switch(e){case"left":default:return 0;case"center":return.5;case"right":return 1}}function Bt(e){return e.createBuffer(1,1,44100)}T(Dt,"anchorPt"),T(Pt,"alignPt"),T(Bt,"createEmptyAudioBuffer");var Ct=T(((e={})=>{let t=e.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let i=e.canvas??(()=>{let e=document.createElement("canvas");return t.appendChild(e),e})(),n=e.scale??1,s=e.width&&e.height&&!e.stretch&&!e.letterbox;s?(i.width=e.width*n,i.height=e.height*n):(i.width=i.parentElement.offsetWidth,i.height=i.parentElement.offsetHeight);let r=["outline: none","cursor: default"];if(s){let e=i.width,t=i.height;r.push(`width: ${e}px`),r.push(`height: ${t}px`)}else r.push("width: 100%"),r.push("height: 100%");e.crisp&&(r.push("image-rendering: pixelated"),r.push("image-rendering: crisp-edges")),i.style.cssText=r.join(";");let o=e.pixelDensity||window.devicePixelRatio;i.width*=o,i.height*=o,i.tabIndex=0;let a=document.createElement("canvas");a.width=Vt,a.height=Vt;let l=a.getContext("2d",{willReadFrequently:!0}),h=We({canvas:i,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS}),u=[],d=h.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),c=it(d,{texFilter:e.texFilter}),p=(()=>{let t=ut(kt,Tt),i=Ze.fromImage(c,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),s=e.width&&e.height?new _e(c,e.width*o*n,e.height*o*n):new _e(c,d.drawingBufferWidth,d.drawingBufferHeight),r=null,a=1;e.background&&(r=O(e.background),a=Array.isArray(e.background)?e.background[3]:1,d.clearColor(r.r/255,r.g/255,r.b/255,a??1)),d.enable(d.BLEND),d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);let l=new et(c,xt,Et,12288),h=Ze.fromImage(c,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:t,defTex:i,frameBuffer:s,postShader:null,postShaderUniform:null,renderer:l,transform:new j,transformStack:[],bgTex:h,bgColor:r,bgAlpha:a,width:e.width??d.drawingBufferWidth/o/n,height:e.height??d.drawingBufferHeight/o/n,viewport:{x:0,y:0,width:d.drawingBufferWidth,height:d.drawingBufferHeight},fixed:!1}})();const f=class e{constructor(e,t,i={},n=null){R(this,"tex"),R(this,"frames",[new q(0,0,1,1)]),R(this,"anims",{}),R(this,"slice9",null),this.tex=e,t&&(this.frames=t),this.anims=i,this.slice9=n}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(t,i={}){return"string"==typeof t?e.fromURL(t,i):Promise.resolve(e.fromImage(t,i))}static fromImage(t,i={}){let[n,s]=A.packer.add(t),r=i.frames?i.frames.map((e=>new q(s.x+e.x*s.w,s.y+e.y*s.h,e.w*s.w,e.h*s.h))):ee(i.sliceX||1,i.sliceY||1,s.x,s.y,s.w,s.h);return new e(n,r,i.anims,i.slice9)}static fromURL(t,i={}){return ht(t).then((t=>e.fromImage(t,i)))}};T(f,"SpriteData");let g=f;const m=class e{constructor(e){R(this,"buf"),this.buf=e}static fromArrayBuffer(t){return new Promise(((e,i)=>y.ctx.decodeAudioData(t,e,i))).then((t=>new e(t)))}static fromURL(t){return Re(t)?e.fromArrayBuffer(Ve(t)):lt(t).then((t=>e.fromArrayBuffer(t)))}};T(m,"SoundData");let w=m,y=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();t.connect(e.destination);let i=new w(Bt(e));return e.decodeAudioData(wt.buffer.slice(0)).then((e=>{i.buf=e})).catch((e=>{console.error("Failed to load burp: ",e)})),{ctx:e,masterNode:t,burpSnd:i}})(),A={urlPrefix:"",sprites:new st,fonts:new st,bitmapFonts:new st,sounds:new st,shaders:new st,custom:new st,packer:new mt(c,2048,2048),loaded:!1};function v(e){return"string"!=typeof e||Re(e)?e:A.urlPrefix+e}T(v,"fixURL");let V={events:new ye,objEvents:new ye,root:ki([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new U(1),angle:0,shake:0,transform:new j}};function b(e){return A.custom.add(null,e)}function x(){let e=[A.sprites,A.sounds,A.shaders,A.fonts,A.bitmapFonts,A.custom];return e.reduce(((e,t)=>e+t.progress()),0)/e.length}function E(e){return void 0!==e&&(A.urlPrefix=e),A.urlPrefix}function S(e,t){return A.custom.add(e,ot(t))}V.root.use(pn()),T(b,"load"),T(x,"loadProgress"),T(E,"loadRoot"),T(S,"loadJSON");const k=class{constructor(e,t={}){if(R(this,"fontface"),R(this,"filter",bt),R(this,"outline",null),R(this,"size",64),this.fontface=e,this.filter=t.filter??bt,this.size=t.size??64,this.size>Vt)throw new Error("Max font size: 256");t.outline&&(this.outline={width:1,color:O(0,0,0)},"number"==typeof t.outline?this.outline.width=t.outline:"object"==typeof t.outline&&(t.outline.width&&(this.outline.width=t.outline.width),t.outline.color&&(this.outline.color=t.outline.color)))}};T(k,"FontData");let M=k;function Y(e,t,i={}){let n=new FontFace(e,"string"==typeof t?`url(${t})`:t);return document.fonts.add(n),A.fonts.add(e,n.load().catch((e=>{throw new Error(`Failed to load font from "${t}": ${e}`)})).then((e=>new M(e,i))))}function Q(e,t,i,n,s={}){return A.bitmapFonts.add(e,ht(t).then((e=>dt(Ze.fromImage(c,e,s),i,n,s.chars??yt))))}function ee(e=1,t=1,i=0,n=0,s=1,r=1){let o=[],a=s/e,l=r/t;for(let h=0;h<t;h++)for(let t=0;t<e;t++)o.push(new q(i+t*a,n+h*l,a,l));return o}function oe(e,t){return e=v(e),b("string"==typeof t?new Promise(((i,n)=>{ot(t).then((t=>{oe(e,t).then(i).catch(n)}))})):g.from(e).then((e=>{let i={};for(let n in t){let s=t[n],r=e.frames[0],o=2048*r.w,a=2048*r.h,l=s.frames?s.frames.map((e=>new q(r.x+(s.x+e.x)/o*r.w,r.y+(s.y+e.y)/a*r.h,e.w/o*r.w,e.h/a*r.h))):ee(s.sliceX||1,s.sliceY||1,r.x+s.x/o*r.w,r.y+s.y/a*r.h,s.width/o*r.w,s.height/a*r.h),h=new g(e.tex,l,s.anims);A.sprites.addLoaded(n,h),i[n]=h}return i})))}function ce(e,t={}){let i=document.createElement("canvas"),n=e[0].width,s=e[0].height;i.width=n*e.length,i.height=s;let r=i.getContext("2d");e.forEach(((e,t)=>{e instanceof ImageData?r.putImageData(e,t*n,0):r.drawImage(e,t*n,0)}));let o=r.getImageData(0,0,e.length*n,s);return g.fromImage(o,{...t,sliceX:e.length,sliceY:1})}function Ae(e,t,i={sliceX:1,sliceY:1,anims:{}}){return t=v(t),Array.isArray(t)?t.some((e=>"string"==typeof e))?A.sprites.add(e,Promise.all(t.map((e=>"string"==typeof e?ht(e):Promise.resolve(e)))).then((e=>ce(e,i)))):A.sprites.addLoaded(e,ce(t,i)):"string"==typeof t?A.sprites.add(e,g.from(t,i)):A.sprites.addLoaded(e,g.fromImage(t,i))}function ve(e,t){return t=v(t),A.sprites.add(e,new Promise((async e=>{let i="string"==typeof t?await ot(t):t,n=await Promise.all(i.frames.map(ht)),s=document.createElement("canvas");s.width=i.width,s.height=i.height*i.frames.length;let r=s.getContext("2d");n.forEach(((e,t)=>{r.drawImage(e,0,t*i.height)})),e(await Ae(null,s,{sliceY:i.frames.length,anims:i.anims}))})))}function Pe(e,t,i){t=v(t),i=v(i),"string"==typeof t&&!i&&(i=ke(t)+".json");let n="string"==typeof i?ot(i):Promise.resolve(i);return A.sprites.add(e,n.then((e=>{let i=e.meta.size,n=e.frames.map((e=>new q(e.frame.x/i.w,e.frame.y/i.h,e.frame.w/i.w,e.frame.h/i.h))),s={};for(let t of e.meta.frameTags)t.from===t.to?s[t.name]=t.from:s[t.name]={from:t.from,to:t.to,speed:10,loop:!0,pingpong:"pingpong"===t.direction};return g.from(t,{frames:n,anims:s})})))}function Ce(e,t,i){return A.shaders.addLoaded(e,ut(t,i))}function Fe(e,t,i){t=v(t),i=v(i);let n=T((e=>e?at(e):Promise.resolve(null)),"resolveUrl"),s=Promise.all([n(t),n(i)]).then((([e,t])=>ut(e,t)));return A.shaders.add(e,s)}function Ue(e,t){return t=v(t),A.sounds.add(e,"string"==typeof t?w.fromURL(t):w.fromArrayBuffer(t))}function Ne(e="bean"){return Ae(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==")}function Le(e){return A.sprites.get(e)}function Oe(e){return A.sounds.get(e)}function Ge(e){return A.fonts.get(e)}function qe(e){return A.bitmapFonts.get(e)}function Ke(e){return A.shaders.get(e)}function je(e){return A.custom.get(e)}function He(e){if("string"==typeof e){let t=Le(e);if(t)return t;if(x()<1)return null;throw new Error(`Sprite not found: ${e}`)}if(e instanceof g)return nt.loaded(e);if(e instanceof nt)return e;throw new Error(`Invalid sprite: ${e}`)}function Ye(e){if("string"==typeof e){let t=Oe(e);if(t)return t;if(x()<1)return null;throw new Error(`Sound not found: ${e}`)}if(e instanceof w)return nt.loaded(e);if(e instanceof nt)return e;throw new Error(`Invalid sound: ${e}`)}function ze(e){if(!e)return p.defShader;if("string"==typeof e){let t=Ke(e);if(t)return t.data??t;if(x()<1)return null;throw new Error(`Shader not found: ${e}`)}return e instanceof nt&&e.data?e.data:e}function Qe(t){if(!t)return Qe(e.font??"monospace");if("string"==typeof t){let e=qe(t),i=Ge(t);if(e)return e.data??e;if(i)return i.data??i;if(document.fonts.check(`64px ${t}`))return t;if(x()<1)return null;throw new Error(`Font not found: ${t}`)}return t instanceof nt&&t.data?t.data:t}function Xe(e){return void 0!==e&&(y.masterNode.gain.value=e),y.masterNode.gain.value}function Je(e,t={}){let i=y.ctx,n=t.paused??!1,s=i.createBufferSource(),r=new we,o=i.createGain(),a=t.seek??0,l=0,h=0,u=!1;s.loop=!!t.loop,s.detune.value=t.detune??0,s.playbackRate.value=t.speed??1,s.connect(o),s.onended=()=>{var e;p()>=(null==(e=s.buffer)?void 0:e.duration)&&r.trigger()},o.connect(y.masterNode),o.gain.value=t.volume??1;let d=T((e=>{s.buffer=e.buf,n||(l=i.currentTime,s.start(0,a),u=!0)}),"start"),c=Ye(e);c instanceof nt&&c.onLoad(d);let p=T((()=>{if(!s.buffer)return 0;let e=n?h-l:i.currentTime-l,t=s.buffer.duration;return s.loop?e%t:Math.min(e,t)}),"getTime"),f=T((e=>{let t=i.createBufferSource();return t.buffer=e.buffer,t.loop=e.loop,t.playbackRate.value=e.playbackRate.value,t.detune.value=e.detune.value,t.onended=e.onended,t.connect(o),t}),"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(e){if(n!==e)if(n=e,e)u&&(s.stop(),u=!1),h=i.currentTime;else{s=f(s);let e=h-l;s.start(0,e),u=!0,l=i.currentTime-e,h=0}},get paused(){return n},play(e=0){this.seek(e),this.paused=!1},seek(e){var t;(null==(t=s.buffer)?void 0:t.duration)&&(e>s.buffer.duration||(n?(s=f(s),l=h-e):(s.stop(),s=f(s),l=i.currentTime-e,s.start(0,e),u=!0,h=0)))},set speed(e){s.playbackRate.value=e},get speed(){return s.playbackRate.value},set detune(e){s.detune.value=e},get detune(){return s.detune.value},set volume(e){o.gain.value=Math.max(e,0)},get volume(){return o.gain.value},set loop(e){s.loop=e},get loop(){return s.loop},duration(){var e;return(null==(e=s.buffer)?void 0:e.duration)??0},time(){return p()%this.duration()},onEnd:e=>r.add(e),then(e){return this.onEnd(e)}}}function tt(e){return Je(y.burpSnd,e)}function rt(e,t){return new _e(c,e,t)}function ut(e=kt,t=Tt){let i=St.replace("{{user}}",e??kt),n=Rt.replace("{{user}}",t??Tt);try{return new $e(c,i,n,xt.map((e=>e.name)))}catch(s){let e=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,t=Ie(s).match(e),i=Number(t.groups.line)-14,n=t.groups.msg.trim(),r=t.groups.type.toLowerCase();throw new Error(`${r} shader line ${i}: ${n}`)}}function dt(e,t,i,n){let s=e.width/t,r={},o=n.split("").entries();for(let[a,l]of o)r[l]=new q(a%s*t,Math.floor(a/s)*i,t,i);return{tex:e,map:r,size:i}}function ct(e,t,i,n=p.defTex,s=p.defShader,r={}){let o=ze(s);if(!o||o instanceof nt)return;let a=p.fixed||i?p.transform:V.cam.transform.mult(p.transform),l=[];for(let h of e){let e=Ut(a.multVec2(h.pos));l.push(e.x,e.y,h.uv.x,h.uv.y,h.color.r/255,h.color.g/255,h.color.b/255,h.opacity)}p.renderer.push(d.TRIANGLES,l,t,o,n,r)}function pt(){p.renderer.flush()}function ft(){d.clear(d.COLOR_BUFFER_BIT),p.frameBuffer.bind(),d.clear(d.COLOR_BUFFER_BIT),p.bgColor||si((()=>{jt({width:ci(),height:pi(),quad:new q(0,0,ci()/64,pi()/64),tex:p.bgTex,fixed:!0})})),p.renderer.numDraws=0,p.fixed=!1,p.transformStack.length=0,p.transform=new j}function Ct(e,t){p.postShader=e,p.postShaderUniform=t??null}function Ft(){pt(),p.lastDrawCalls=p.renderer.numDraws,p.frameBuffer.unbind(),d.viewport(0,0,d.drawingBufferWidth,d.drawingBufferHeight);let e=p.width,t=p.height;p.width=d.drawingBufferWidth/o,p.height=d.drawingBufferHeight/o,Ht({flipY:!0,tex:p.frameBuffer.tex,pos:new U(p.viewport.x,p.viewport.y),width:p.viewport.width,height:p.viewport.height,shader:p.postShader,uniform:"function"==typeof p.postShaderUniform?p.postShaderUniform():p.postShaderUniform,fixed:!0}),pt(),p.width=e,p.height=t}function Ut(e){return new U(e.x/ci()*2-1,-e.y/pi()*2+1)}function Nt(e){p.transform=e.clone()}function Lt(...e){if(void 0===e[0])return;let t=N(...e);0===t.x&&0===t.y||p.transform.translate(t)}function Ot(...e){if(void 0===e[0])return;let t=N(...e);1===t.x&&1===t.y||p.transform.scale(t)}function Gt(e){e&&p.transform.rotate(e)}function qt(){p.transformStack.push(p.transform.clone())}function Kt(){p.transformStack.length>0&&(p.transform=p.transformStack.pop())}function jt(e){if(void 0===e.width||void 0===e.height)throw new Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,i=e.height,n=Dt(e.anchor||At).scale(new U(t,i).scale(-.5)),s=e.quad||new q(0,0,1,1),r=e.color||O(255,255,255),o=e.opacity??1,a=e.tex?.1/e.tex.width:0,l=e.tex?.1/e.tex.height:0,h=s.x+a,u=s.y+l,d=s.w-2*a,c=s.h-2*l;qt(),Lt(e.pos),Gt(e.angle),Ot(e.scale),Lt(n),ct([{pos:new U(-t/2,i/2),uv:new U(e.flipX?h+d:h,e.flipY?u:u+c),color:r,opacity:o},{pos:new U(-t/2,-i/2),uv:new U(e.flipX?h+d:h,e.flipY?u+c:u),color:r,opacity:o},{pos:new U(t/2,-i/2),uv:new U(e.flipX?h:h+d,e.flipY?u+c:u),color:r,opacity:o},{pos:new U(t/2,i/2),uv:new U(e.flipX?h:h+d,e.flipY?u:u+c),color:r,opacity:o}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform),Kt()}function Ht(e){if(!e.tex)throw new Error('drawTexture() requires property "tex".');let t=e.quad??new q(0,0,1,1),i=e.tex.width*t.w,n=e.tex.height*t.h,s=new U(1);if(e.tiled){let r=Math.ceil((e.width||i)/i),o=Math.ceil((e.height||n)/n),a=Dt(e.anchor||At).add(new U(1,1)).scale(.5).scale(r*i,o*n);for(let l=0;l<r;l++)for(let r=0;r<o;r++)jt(Object.assign({},e,{pos:(e.pos||new U(0)).add(new U(i*l,n*r)).sub(a),scale:s.scale(e.scale||new U(1)),tex:e.tex,quad:t,width:i,height:n,anchor:"topleft"}))}else e.width&&e.height?(s.x=e.width/i,s.y=e.height/n):e.width?(s.x=e.width/i,s.y=s.x):e.height&&(s.y=e.height/n,s.x=s.y),jt(Object.assign({},e,{scale:s.scale(e.scale||new U(1)),tex:e.tex,quad:t,width:i,height:n}))}function Yt(e){if(!e.sprite)throw new Error('drawSprite() requires property "sprite"');let t=He(e.sprite);if(!t||!t.data)return;let i=t.data.frames[e.frame??0];if(!i)throw new Error(`Frame not found: ${e.frame??0}`);Ht(Object.assign({},e,{tex:t.data.tex,quad:i.scale(e.quad??new q(0,0,1,1))}))}function zt(e,t,i,n,s,r=1){n=I(n%360),(s=I(s%360))<=n&&(s+=2*Math.PI);let o=[],a=(s-n)/Math.ceil((s-n)/I(8)*r);for(let l=n;l<s;l+=a)o.push(e.add(t*Math.cos(l),i*Math.sin(l)));return o.push(e.add(t*Math.cos(s),i*Math.sin(s))),o}function Qt(e){if(void 0===e.width||void 0===e.height)throw new Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,i=e.height,n=Dt(e.anchor||At).add(1,1).scale(new U(t,i).scale(-.5)),s=[new U(0,0),new U(t,0),new U(t,i),new U(0,i)];if(e.radius){let n=Math.min(Math.min(t,i)/2,e.radius);s=[new U(n,0),new U(t-n,0),...zt(new U(t-n,n),n,n,270,360),new U(t,n),new U(t,i-n),...zt(new U(t-n,i-n),n,n,0,90),new U(t-n,i),new U(n,i),...zt(new U(n,i-n),n,n,90,180),new U(0,i-n),new U(0,n),...zt(new U(n,n),n,n,180,270)]}$t(Object.assign({},e,{offset:n,pts:s,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}function Xt(e){let{p1:t,p2:i}=e;if(!t||!i)throw new Error('drawLine() requires properties "p1" and "p2".');let n=e.width||1,s=i.sub(t).unit().normal().scale(.5*n);ct([t.sub(s),t.add(s),i.add(s),i.sub(s)].map((t=>({pos:new U(t.x,t.y),uv:new U(0),color:e.color??L.WHITE,opacity:e.opacity??1}))),[0,1,3,1,2,3],e.fixed,p.defTex,e.shader,e.uniform)}function Jt(e){let t=e.pts;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2))if(e.radius&&t.length>=3){let i=t[0].sdist(t[1]);for(let e=1;e<t.length-1;e++)i=Math.min(t[e].sdist(t[e+1]),i);Math.min(e.radius,Math.sqrt(i)/2),Xt(Object.assign({},e,{p1:t[0],p2:t[1]}));for(let n=1;n<t.length-2;n++){let i=t[n],s=t[n+1];Xt(Object.assign({},e,{p1:i,p2:s}))}Xt(Object.assign({},e,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let i=0;i<t.length-1;i++)Xt(Object.assign({},e,{p1:t[i],p2:t[i+1]})),"none"!==e.join&&Zt(Object.assign({},e,{pos:t[i],radius:e.width/2}))}function Wt(e){if(!e.p1||!e.p2||!e.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return $t(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}function Zt(e){if("number"!=typeof e.radius)throw new Error('drawCircle() requires property "radius".');0!==e.radius&&_t(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}function _t(e){if(void 0===e.radiusX||void 0===e.radiusY)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(0===e.radiusX||0===e.radiusY)return;let t=e.start??0,i=e.end??360,n=Dt(e.anchor??"center").scale(new U(-e.radiusX,-e.radiusY)),s=zt(n,e.radiusX,e.radiusY,t,i,e.resolution);s.unshift(n);let r=Object.assign({},e,{pts:s,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(s.length-1).fill(e.gradient[1])]}:{}});if(i-t>=360&&e.outline)return!1!==e.fill&&$t(Object.assign(r,{outline:null})),void $t(Object.assign(r,{pts:s.slice(1),fill:!1}));$t(r)}function $t(e){if(!e.pts)throw new Error('drawPolygon() requires property "pts".');let t=e.pts.length;if(!(t<3)){if(qt(),Lt(e.pos),Ot(e.scale),Gt(e.angle),Lt(e.offset),!1!==e.fill){let i=e.color??L.WHITE,n=e.pts.map(((t,n)=>({pos:new U(t.x,t.y),uv:new U(0,0),color:e.colors&&e.colors[n]?e.colors[n].mult(i):i,opacity:e.opacity??1}))),s=[...Array(t-2).keys()].map((e=>[0,e+1,e+2])).flat();ct(n,e.indices??s,e.fixed,p.defTex,e.shader,e.uniform)}e.outline&&Jt({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity}),Kt()}}function ei(e,t,i){pt(),d.clear(d.STENCIL_BUFFER_BIT),d.enable(d.STENCIL_TEST),d.stencilFunc(d.NEVER,1,255),d.stencilOp(d.REPLACE,d.REPLACE,d.REPLACE),t(),pt(),d.stencilFunc(i,1,255),d.stencilOp(d.KEEP,d.KEEP,d.KEEP),e(),pt(),d.disable(d.STENCIL_TEST)}function ti(e,t){ei(e,t,d.EQUAL)}function ii(e,t){ei(e,t,d.NOTEQUAL)}function ni(){return(p.viewport.width+p.viewport.height)/(p.width+p.height)}function si(e){pt();let t=p.width,i=p.height;p.width=p.viewport.width,p.height=p.viewport.height,e(),pt(),p.width=t,p.height=i}function ri(e,t){t.pos&&(e.pos=e.pos.add(t.pos)),t.scale&&(e.scale=e.scale.scale(N(t.scale))),t.angle&&(e.angle+=t.angle),t.color&&1===e.ch.length&&(e.color=e.color.mult(t.color)),t.opacity&&(e.opacity*=t.opacity)}T(Y,"loadFont"),T(Q,"loadBitmapFont"),T(ee,"slice"),T(oe,"loadSpriteAtlas"),T(ce,"createSpriteSheet"),T(Ae,"loadSprite"),T(ve,"loadPedit"),T(Pe,"loadAseprite"),T(Ce,"loadShader"),T(Fe,"loadShaderURL"),T(Ue,"loadSound"),T(Ne,"loadBean"),T(Le,"getSprite"),T(Oe,"getSound"),T(Ge,"getFont"),T(qe,"getBitmapFont"),T(Ke,"getShader"),T(je,"getAsset"),T(He,"resolveSprite"),T(Ye,"resolveSound"),T(ze,"resolveShader"),T(Qe,"resolveFont"),T(Xe,"volume"),T(Je,"play"),T(tt,"burp"),T(rt,"makeCanvas"),T(ut,"makeShader"),T(dt,"makeFont"),T(ct,"drawRaw"),T(pt,"flush"),T(ft,"frameStart"),T(Ct,"usePostEffect"),T(Ft,"frameEnd"),T(Ut,"screen2ndc"),T(Nt,"pushMatrix"),T(Lt,"pushTranslate"),T(Ot,"pushScale"),T(Gt,"pushRotate"),T(qt,"pushTransform"),T(Kt,"popTransform"),T(jt,"drawUVQuad"),T(Ht,"drawTexture"),T(Yt,"drawSprite"),T(zt,"getArcPts"),T(Qt,"drawRect"),T(Xt,"drawLine"),T(Jt,"drawLines"),T(Wt,"drawTriangle"),T(Zt,"drawCircle"),T(_t,"drawEllipse"),T($t,"drawPolygon"),T(ei,"drawStenciled"),T(ti,"drawMasked"),T(ii,"drawSubtracted"),T(ni,"getViewportScale"),T(si,"drawUnscaled"),T(ri,"applyCharTransform");let oi=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function ai(e){let t={},i=e.replace(oi,"$2"),n=0;for(let s of e.matchAll(oi)){let e=s.index-n;for(let i=0;i<s.groups.text.length;i++)t[i+e]=[s.groups.style];n+=s[0].length-s.groups.text.length}return{charStyleMap:t,text:i}}T(ai,"compileStyledText");let li={};function hi(e){var t,i;if(void 0===e.text)throw new Error('formatText() requires property "text".');let n=Qe(e.font);if(""===e.text||n instanceof nt||!n)return{width:0,height:0,chars:[],opt:e};let{charStyleMap:s,text:r}=ai(e.text+""),o=Be(r);if(n instanceof M||"string"==typeof n){let e=n instanceof M?n.fontface.family:n,s=n instanceof M?{outline:n.outline,filter:n.filter}:{outline:null,filter:bt},r=li[e]??{font:{tex:new Ze(c,2048,2048,{filter:s.filter}),map:{},size:64},cursor:new U(0),outline:s.outline};li[e]||(li[e]=r),n=r.font;for(let h of o)if(!r.font.map[h]){let s=l;s.clearRect(0,0,a.width,a.height),s.font=`${n.size}px ${e}`,s.textBaseline="top",s.textAlign="left",s.fillStyle="#ffffff";let o=s.measureText(h),u=Math.ceil(o.width),d=n.size;r.outline&&(s.lineJoin="round",s.lineWidth=2*r.outline.width,s.strokeStyle=r.outline.color.toHex(),s.strokeText(h,r.outline.width,r.outline.width),u+=2*r.outline.width,d+=3*r.outline.width),s.fillText(h,(null==(t=r.outline)?void 0:t.width)??0,(null==(i=r.outline)?void 0:i.width)??0);let c=s.getImageData(0,0,u,d);if(r.cursor.x+u>2048&&(r.cursor.x=0,r.cursor.y+=d,r.cursor.y>2048))throw new Error("Font atlas exceeds character limit");n.tex.update(c,r.cursor.x,r.cursor.y),n.map[h]=new q(r.cursor.x,r.cursor.y,u,d),r.cursor.x+=u}}let h=e.size||n.size,u=N(e.scale??1).scale(h/n.size),d=e.lineSpacing??0,p=e.letterSpacing??0,f=0,g=0,m=0,w=[],y=[],A=0,v=null,V=null;for(;A<o.length;){let t=o[A];if("\n"===t)m+=h+d,w.push({width:f-p,chars:y}),v=null,V=null,f=0,y=[];else{let i=n.map[t];if(i){let s=i.w*u.x;e.width&&f+s>e.width&&(m+=h+d,null!=v&&(A-=y.length-v,t=o[A],i=n.map[t],s=i.w*u.x,y=y.slice(0,v-1),f=V),v=null,V=null,w.push({width:f-p,chars:y}),f=0,y=[]),y.push({tex:n.tex,width:i.w,height:i.h,quad:new q(i.x/n.tex.width,i.y/n.tex.height,i.w/n.tex.width,i.h/n.tex.height),ch:t,pos:new U(f,m),opacity:e.opacity??1,color:e.color??L.WHITE,scale:N(u),angle:0})," "===t&&(v=y.length,V=f),f+=s,g=Math.max(g,f),f+=p}}A++}w.push({width:f-p,chars:y}),m+=h,e.width&&(g=e.width);let b=[];for(let a of w){let t=(g-a.width)*Pt(e.align??"left");for(let i of a.chars){let r=n.map[i.ch],o=b.length;if(i.pos=i.pos.add(t,0).add(r.w*u.x*.5,r.h*u.y*.5),e.transform){let t="function"==typeof e.transform?e.transform(o,i.ch):e.transform;t&&ri(i,t)}if(s[o]){let t=s[o];for(let n of t){let t=e.styles[n],s="function"==typeof t?t(o,i.ch):t;s&&ri(i,s)}}b.push(i)}}return{width:g,height:m,chars:b,opt:e}}function ui(e){di(hi(e))}function di(e){qt(),Lt(e.opt.pos),Gt(e.opt.angle),Lt(Dt(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach((t=>{jt({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})})),Kt()}function ci(){return p.width}function pi(){return p.height}function fi(e){return new U((e.x-p.viewport.x)*ci()/p.viewport.width,(e.y-p.viewport.y)*pi()/p.viewport.height)}function gi(e){return new U(e.x*p.viewport.width/p.width,e.y*p.viewport.height/p.height)}function mi(){return fi(h.mousePos())}T(hi,"formatText"),T(ui,"drawText"),T(di,"drawFormattedText"),T(ci,"width"),T(pi,"height"),T(fi,"windowToContent"),T(gi,"contentToView"),T(mi,"mousePos");let wi=!1,yi={inspect:!1,timeScale:1,showLog:!0,fps:()=>h.fps(),numFrames:()=>h.numFrames(),stepFrame:_n,drawCalls:()=>p.lastDrawCalls,clearLog:()=>V.logs=[],log:t=>{let i=e.logMax??8;V.logs.unshift({msg:t,time:h.time()}),V.logs.length>i&&(V.logs=V.logs.slice(0,i))},error:e=>yi.log(new Error(e.toString?e.toString():e)),curRecording:null,numObjects:()=>Hn("*",{recursive:!0}).length,get paused(){return wi},set paused(e){wi=e,e?y.ctx.suspend():y.ctx.resume()}};function Ai(){return h.dt()*yi.timeScale}function vi(...e){return e.length>0&&(V.cam.pos=N(...e)),V.cam.pos?V.cam.pos.clone():Bn()}function Vi(...e){return e.length>0&&(V.cam.scale=N(...e)),V.cam.scale.clone()}function bi(e){return void 0!==e&&(V.cam.angle=e),V.cam.angle}function xi(e=12){V.cam.shake+=e}function Ei(e){return V.cam.transform.multVec2(e)}function Si(e){return V.cam.transform.invert().multVec2(e)}function Ri(e){let t=new j;return e.pos&&t.translate(e.pos),e.scale&&t.scale(e.scale),e.angle&&t.rotate(e.angle),e.parent?t.mult(e.parent.transform):t}function ki(e=[]){let t=new Map,i={},n=new ye,s=[],r=null,o=!1,a={id:Me(),hidden:!1,transform:new j,children:[],parent:null,set paused(e){if(e!==o){o=e;for(let t of s)t.paused=e}},get paused(){return o},add(e=[]){let t=Array.isArray(e)?ki(e):e;if(t.parent)throw new Error("Cannot add a game obj that already has a parent.");return t.parent=this,t.transform=Ri(t),this.children.push(t),t.trigger("add",t),V.events.trigger("add",t),t},readd(e){let t=this.children.indexOf(e);return-1!==t&&(this.children.splice(t,1),this.children.push(e)),e},remove(e){let t=this.children.indexOf(e);if(-1!==t){e.parent=null,this.children.splice(t,1);let i=T((e=>{e.trigger("destroy"),V.events.trigger("destroy",e),e.children.forEach((e=>i(e)))}),"trigger");i(e)}},removeAll(e){if(e)this.get(e).forEach((e=>this.remove(e)));else for(let t of[...this.children])this.remove(t)},update(){this.paused||(this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.update())),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&this.canvas.bind();let e=p.fixed;this.fixed&&(p.fixed=!0),qt(),Lt(this.pos),Ot(this.scale),Gt(this.angle);let t=this.children.sort(((e,t)=>(e.z??0)-(t.z??0)));if(this.mask){let e={intersect:ti,subtract:ii}[this.mask];if(!e)throw new Error(`Invalid mask func: "${this.mask}"`);e((()=>{t.forEach((e=>e.draw()))}),(()=>{this.trigger("draw")}))}else this.trigger("draw"),t.forEach((e=>e.draw()));Kt(),p.fixed=e,this.canvas&&this.canvas.unbind()},drawInspect(){this.hidden||(qt(),Lt(this.pos),Ot(this.scale),Gt(this.angle),this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.drawInspect())),this.trigger("drawInspect"),Kt())},use(e){if(!e)return;if("string"==typeof e)return this.use({id:e});let n=[];e.id&&(this.unuse(e.id),i[e.id]=[],n=i[e.id],t.set(e.id,e));for(let t in e){if(Mt.has(t))continue;let i=Object.getOwnPropertyDescriptor(e,t);if("function"==typeof i.value&&(e[t]=e[t].bind(this)),i.set&&Object.defineProperty(e,t,{set:i.set.bind(this)}),i.get&&Object.defineProperty(e,t,{get:i.get.bind(this)}),It.has(t)){let i="add"===t?()=>{r=T((e=>n.push(e)),"onCurCompCleanup"),e[t](),r=null}:e[t];n.push(this.on(t,i).cancel)}else{if(void 0!==this[t])throw new Error(`Duplicate component property: "${t}"`);Object.defineProperty(this,t,{get:()=>e[t],set:i=>e[t]=i,configurable:!0,enumerable:!0}),n.push((()=>delete this[t]))}}let s=T((()=>{if(e.require)for(let t of e.require)if(!this.c(t))throw new Error(`Component "${e.id}" requires component "${t}"`)}),"checkDeps");e.destroy&&n.push(e.destroy.bind(this)),this.exists()?(s(),e.add&&(r=T((e=>n.push(e)),"onCurCompCleanup"),e.add.call(this),r=null)):e.require&&n.push(this.on("add",s).cancel)},unuse(e){i[e]&&(i[e].forEach((e=>e())),delete i[e]),t.has(e)&&t.delete(e)},c:e=>t.get(e),get(e,t={}){let i=t.recursive?this.children.flatMap(T((function e(t){return[t,...t.children.flatMap(e)]}),"recurse")):this.children;if(i=i.filter((t=>!e||t.is(e))),t.liveUpdate){let n=T((e=>t.recursive?this.isAncestorOf(e):e.parent===this),"isChild"),s=[];s.push(Di((t=>{n(t)&&t.is(e)&&i.push(t)}))),s.push(Pi((t=>{if(n(t)&&t.is(e)){let e=i.findIndex((e=>e.id===t.id));-1!==e&&i.splice(e,1)}}))),this.onDestroy((()=>{for(let e of s)e.cancel()}))}return i},isAncestorOf(e){return!!e.parent&&(e.parent===this||this.isAncestorOf(e.parent))},exists(){return V.root.isAncestorOf(this)},is(e){if("*"===e)return!0;if(Array.isArray(e)){for(let t of e)if(!this.c(t))return!1;return!0}return null!=this.c(e)},on(e,t){let i=n.on(e,t.bind(this));return r&&r((()=>i.cancel())),i},trigger(e,...t){n.trigger(e,...t),V.objEvents.trigger(e,this,...t)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let e={};for(let[i,n]of t)e[i]=n.inspect?n.inspect():null;return e},onAdd(e){return this.on("add",e)},onUpdate(e){return this.on("update",e)},onDraw(e){return this.on("draw",e)},onDestroy(e){return this.on("destroy",e)},clearEvents(){n.clear()}},l=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"];for(let u of l)a[u]=(...e)=>{let t=h[u](...e);return s.push(t),a.onDestroy((()=>t.cancel())),t};for(let h of e)a.use(h);return a}function Ti(e,t,i){return V.objEvents[e]||(V.objEvents[e]=new ge),V.objEvents.on(e,((e,...n)=>{e.is(t)&&i(e,...n)}))}T(Ai,"dt"),T(vi,"camPos"),T(Vi,"camScale"),T(bi,"camRot"),T(xi,"shake"),T(Ei,"toScreen"),T(Si,"toWorld"),T(Ri,"calcTransform"),T(ki,"make"),T(Ti,"on");let Mi=Te((e=>{let t=qn([{update:e}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:()=>t.destroy()}}),((e,t)=>Ti("update",e,t))),Ii=Te((e=>{let t=qn([{draw:e}]);return{get paused(){return t.hidden},set paused(e){t.hidden=e},cancel:()=>t.destroy()}}),((e,t)=>Ti("draw",e,t))),Di=Te((e=>V.events.on("add",e)),((e,t)=>Ti("add",e,t))),Pi=Te((e=>V.events.on("destroy",e)),((e,t)=>Ti("destroy",e,t)));function Bi(e,t,i){return Ti("collide",e,((e,n,s)=>n.is(t)&&i(e,n,s)))}function Ci(e,t,i){return Ti("collideUpdate",e,((e,n,s)=>n.is(t)&&i(e,n,s)))}function Fi(e,t,i){return Ti("collideEnd",e,((e,n,s)=>n.is(t)&&i(e,n,s)))}function Ui(e,t){Hn(e,{recursive:!0}).forEach(t),Di(e,t)}T(Bi,"onCollide"),T(Ci,"onCollideUpdate"),T(Fi,"onCollideEnd"),T(Ui,"forAllCurrentAndFuture");let Ni=Te((e=>h.onMousePress(e)),((e,t)=>{let i=[];return Ui(e,(e=>{if(!e.area)throw new Error("onClick() requires the object to have area() component");i.push(e.onClick((()=>t(e))))})),me.join(i)}));function Li(e,t){let i=[];return Ui(e,(e=>{if(!e.area)throw new Error("onHover() requires the object to have area() component");i.push(e.onHover((()=>t(e))))})),me.join(i)}function Oi(e,t){let i=[];return Ui(e,(e=>{if(!e.area)throw new Error("onHoverUpdate() requires the object to have area() component");i.push(e.onHoverUpdate((()=>t(e))))})),me.join(i)}function Gi(e,t){let i=[];return Ui(e,(e=>{if(!e.area)throw new Error("onHoverEnd() requires the object to have area() component");i.push(e.onHoverEnd((()=>t(e))))})),me.join(i)}function qi(e){V.gravity=e}function Ki(){return V.gravity}function ji(...e){1===e.length||2===e.length?(p.bgColor=O(e[0]),e[1]&&(p.bgAlpha=e[1])):(3===e.length||4===e.length)&&(p.bgColor=O(e[0],e[1],e[2]),e[3]&&(p.bgAlpha=e[3])),d.clearColor(p.bgColor.r/255,p.bgColor.g/255,p.bgColor.b/255,p.bgAlpha)}function Hi(){return p.bgColor.clone()}function Yi(...e){return{id:"pos",pos:N(...e),moveBy(...e){this.pos=this.pos.add(N(...e))},move(...e){this.moveBy(N(...e).scale(Ai()))},moveTo(...e){if("number"==typeof e[0]&&"number"==typeof e[1])return this.moveTo(N(e[0],e[1]),e[2]);let t=e[0],i=e[1];if(void 0===i)return void(this.pos=N(t));let n=t.sub(this.pos);n.len()<=i*Ai()?this.pos=N(t):this.move(n.unit().scale(i))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let e=this.worldPos();return nn(this)?e:Ei(e)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){Zt({color:O(255,0,0),radius:4/ni()})}}}function zi(...e){return 0===e.length?zi(1):{id:"scale",scale:N(...e),scaleTo(...e){this.scale=N(...e)},scaleBy(...e){this.scale.scale(N(...e))},inspect(){return`(${Ji(this.scale.x,2)}, ${Ji(this.scale.y,2)})`}}}function Qi(e){return{id:"rotate",angle:e??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`${Math.round(this.angle)}`}}}function Xi(...e){return{id:"color",color:O(...e),inspect(){return this.color.toString()}}}function Ji(e,t){return Number(e.toFixed(t))}function Wi(e){return{id:"opacity",opacity:e??1,inspect(){return`${Ji(this.opacity,1)}`},fadeOut(e=1,t=gt.linear){return Qn(this.opacity,0,e,(e=>this.opacity=e),t)}}}function Zi(e){if(!e)throw new Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return"string"==typeof this.anchor?this.anchor:this.anchor.toString()}}}function _i(e){return{id:"z",z:e,inspect(){return`${this.z}`}}}function $i(e,t){return{id:"follow",require:["pos"],follow:{obj:e,offset:t??N(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function en(e,t){let i="number"==typeof e?U.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(i.scale(t))}}}T(Li,"onHover"),T(Oi,"onHoverUpdate"),T(Gi,"onHoverEnd"),T(qi,"setGravity"),T(Ki,"getGravity"),T(ji,"setBackground"),T(Hi,"getBackground"),T(Yi,"pos"),T(zi,"scale"),T(Qi,"rotate"),T(Xi,"color"),T(Ji,"toFixed"),T(Wi,"opacity"),T(Zi,"anchor"),T(_i,"z"),T($i,"follow"),T(en,"move");function tn(e={}){let t=e.distance??200,i=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let e=this.screenPos(),i=new ue(N(0),ci(),pi());return!ne(i,e)&&i.sdistToPoint(e)>t*t},onExitScreen(e){return this.on("exitView",e)},onEnterScreen(e){return this.on("enterView",e)},update(){this.isOffScreen()?(i||(this.trigger("exitView"),i=!0),e.hide&&(this.hidden=!0),e.pause&&(this.paused=!0),e.destroy&&this.destroy()):(i&&(this.trigger("enterView"),i=!1),e.hide&&(this.hidden=!1),e.pause&&(this.paused=!1))}}}function nn(e){return!!e.fixed||!!e.parent&&nn(e.parent)}function sn(e={}){let t={},i=new Set;return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){this.area.cursor&&this.onHover((()=>h.setCursor(this.area.cursor))),this.onCollideUpdate(((e,n)=>{t[e.id]||this.trigger("collide",e,n),t[e.id]=n,i.add(e.id)}))},update(){for(let e in t)i.has(Number(e))||(this.trigger("collideEnd",t[e].target),delete t[e]);i.clear()},drawInspect(){let e=this.localArea();qt(),Ot(this.area.scale),Lt(this.area.offset);let t={outline:{width:4/ni(),color:O(0,0,255)},anchor:this.anchor,fill:!1,fixed:nn(this)};e instanceof ue?Qt({...t,pos:e.pos,width:e.width,height:e.height}):e instanceof pe?$t({...t,pts:e.pts}):e instanceof de&&Zt({...t,pos:e.center,radius:e.radius}),Kt()},area:{shape:e.shape??null,scale:e.scale?N(e.scale):N(1),offset:e.offset??N(0),cursor:e.cursor??null},isClicked(){return h.isMousePressed()&&this.isHovering()},isHovering(){let e=nn(this)?mi():Si(mi());return this.hasPoint(e)},checkCollision:e=>t[e.id]??null,getCollisions:()=>Object.values(t),isColliding:e=>!!t[e.id],isOverlapping(e){let i=t[e.id];return i&&i.hasOverlap()},onClick(e){let t=h.onMousePress("left",(()=>{this.isHovering()&&e()}));return this.onDestroy((()=>t.cancel())),t},onHover(e){let t=!1;return this.onUpdate((()=>{t?t=this.isHovering():this.isHovering()&&(t=!0,e())}))},onHoverUpdate(e){return this.onUpdate((()=>{this.isHovering()&&e()}))},onHoverEnd(e){let t=!1;return this.onUpdate((()=>{t?this.isHovering()||(t=!1,e()):t=this.isHovering()}))},onCollide(e,t){return"function"==typeof e&&void 0===t?this.on("collide",e):"string"==typeof e?this.onCollide(((i,n)=>{i.is(e)&&t(i,n)})):void 0},onCollideUpdate(e,t){return"function"==typeof e&&void 0===t?this.on("collideUpdate",e):"string"==typeof e?this.on("collideUpdate",((i,n)=>i.is(e)&&t(i,n))):void 0},onCollideEnd(e,t){return"function"==typeof e&&void 0===t?this.on("collideEnd",e):"string"==typeof e?this.on("collideEnd",(i=>i.is(e)&&t(i))):void 0},hasPoint(e){return le(this.worldArea(),e)},resolveCollision(e){let t=this.checkCollision(e);t&&!t.resolved&&(this.pos=this.pos.add(t.displacement),t.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let e=this.localArea();if(!(e instanceof pe||e instanceof ue))throw new Error("Only support polygon and rect shapes for now");let t=this.transform.clone().scale(N(this.area.scale??1)).translate(this.area.offset);if(e instanceof ue){let i=Dt(this.anchor||At).add(1,1).scale(-.5).scale(e.width,e.height);t.translate(i)}return e.transform(t)},screenArea(){let e=this.worldArea();return nn(this)?e:e.transform(V.cam.transform)}}}function rn(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,shader:e.shader,uniform:e.uniform}}function on(e,t={}){let i=null,n=null,s=null,r=new we;if(!e)throw new Error("Please pass the resource name or data to sprite()");let o=T(((e,t,i,n)=>{let s=N(1,1);return i&&n?(s.x=i/(e.width*t.w),s.y=n/(e.height*t.h)):i?(s.x=i/(e.width*t.w),s.y=s.x):n&&(s.y=n/(e.height*t.h),s.x=s.y),s}),"calcTexScale");return{id:"sprite",width:0,height:0,frame:t.frame||0,quad:t.quad||new q(0,0,1,1),animSpeed:t.animSpeed??1,flipX:t.flipX??!1,flipY:t.flipY??!1,draw(){if(!i)return;let e=i.frames[this.frame??0];if(!e)throw new Error(`Frame not found: ${this.frame??0}`);if(i.slice9){let{left:n,right:s,top:r,bottom:o}=i.slice9,a=i.tex.width*e.w,l=i.tex.height*e.h,h=this.width-n-s,u=this.height-r-o,d=n/a,c=s/a,p=1-d-c,f=r/l,g=o/l,m=1-f-g,w=[K(0,0,d,f),K(d,0,p,f),K(d+p,0,c,f),K(0,f,d,m),K(d,f,p,m),K(d+p,f,c,m),K(0,f+m,d,g),K(d,f+m,p,g),K(d+p,f+m,c,g),K(0,0,n,r),K(n,0,h,r),K(n+h,0,s,r),K(0,r,n,u),K(n,r,h,u),K(n+h,r,s,u),K(0,r+u,n,o),K(n,r+u,h,o),K(n+h,r+u,s,o)];for(let y=0;y<9;y++){let n=w[y],s=w[y+9];Ht(Object.assign(rn(this),{pos:s.pos(),tex:i.tex,quad:e.scale(n),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:s.w,height:s.h}))}}else Ht(Object.assign(rn(this),{tex:i.tex,quad:e.scale(this.quad??new q(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:this.width,height:this.height}))},add(){let n=T((e=>{let n=e.frames[0].clone();t.quad&&(n=n.scale(t.quad));let s=o(e.tex,n,t.width,t.height);this.width=e.tex.width*n.w*s.x,this.height=e.tex.height*n.h*s.y,t.anim&&this.play(t.anim),i=e,r.trigger(i)}),"setSpriteData"),s=He(e);s?s.onLoad(n):Rn((()=>n(He(e).data)))},update(){if(!n)return;let e=i.anims[n.name];if("number"!=typeof e){if(0===e.speed)throw new Error("Sprite anim speed cannot be 0");n.timer+=Ai()*this.animSpeed,n.timer>=1/n.speed&&(n.timer=0,this.frame+=s,(this.frame<Math.min(e.from,e.to)||this.frame>Math.max(e.from,e.to))&&(n.loop?n.pingpong?(this.frame-=s,s*=-1,this.frame+=s):this.frame=e.from:(this.frame=e.to,n.onEnd(),this.stop())))}else this.frame=e},play(e,t={}){if(!i)return void r.add((()=>this.play(e,t)));let o=i.anims[e];if(void 0===o)throw new Error(`Anim not found: ${e}`);n&&this.stop(),n="number"==typeof o?{name:e,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:e,timer:0,loop:t.loop??o.loop??!1,pingpong:t.pingpong??o.pingpong??!1,speed:t.speed??o.speed??10,onEnd:t.onEnd??(()=>{})},s="number"==typeof o?null:o.from<o.to?1:-1,this.frame="number"==typeof o?o:o.from,this.trigger("animStart",e)},stop(){if(!n)return;let e=n.name;n=null,this.trigger("animEnd",e)},numFrames:()=>(null==i?void 0:i.frames.length)??0,curAnim:()=>null==n?void 0:n.name,onAnimEnd(e){return this.on("animEnd",e)},onAnimStart(e){return this.on("animStart",e)},renderArea(){return new ue(N(0),this.width,this.height)},inspect(){if("string"==typeof e)return`"${e}"`}}}function an(e,t={}){function i(e){var i,n;let s=hi(Object.assign(rn(e),{text:e.text+"",size:e.textSize,font:e.font,width:t.width&&e.width,align:e.align,letterSpacing:e.letterSpacing,lineSpacing:e.lineSpacing,transform:e.textTransform,styles:e.textStyles}));return t.width||(e.width=s.width/((null==(i=e.scale)?void 0:i.x)||1)),e.height=s.height/((null==(n=e.scale)?void 0:n.y)||1),s}T(i,"update");let n={id:"text",set text(t){e=t,i(this)},get text(){return e},textSize:t.size??36,font:t.font,width:t.width??0,height:0,align:t.align,lineSpacing:t.lineSpacing,letterSpacing:t.letterSpacing,textTransform:t.transform,textStyles:t.styles,add(){Rn((()=>i(this)))},draw(){di(i(this))},renderArea(){return new ue(N(0),this.width,this.height)}};return i(n),n}function ln(e,t={}){if(e.length<3)throw new Error(`Polygon's need more than two points, ${e.length} points provided`);return{id:"polygon",pts:e,colors:t.colors,radius:t.radius,draw(){$t(Object.assign(rn(this),{pts:this.pts,colors:this.colors,radius:this.radius,fill:t.fill}))},renderArea(){return new pe(this.pts)},inspect(){return this.pts.map((e=>`[${e.x},${e.y}]`)).join(",")}}}function hn(e,t,i={}){return{id:"rect",width:e,height:t,radius:i.radius||0,draw(){Qt(Object.assign(rn(this),{width:this.width,height:this.height,radius:this.radius,fill:i.fill}))},renderArea(){return new ue(N(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function un(e,t){return{id:"rect",width:e,height:t,draw(){jt(Object.assign(rn(this),{width:this.width,height:this.height}))},renderArea(){return new ue(N(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function dn(e,t={}){return{id:"circle",radius:e,draw(){Zt(Object.assign(rn(this),{radius:this.radius,fill:t.fill}))},renderArea(){return new ue(new U(this.anchor?0:-this.radius),2*this.radius,2*this.radius)},inspect(){return`${Math.ceil(this.radius)}`}}}function cn(e=1,t=O(0,0,0)){return{id:"outline",outline:{width:e,color:t}}}function pn(){return{id:"timer",wait(e,t){let i=[];t&&i.push(t);let n=0,s=this.onUpdate((()=>{n+=Ai(),n>=e&&(i.forEach((e=>e())),s.cancel())}));return{get paused(){return s.paused},set paused(e){s.paused=e},cancel:s.cancel,onEnd(e){i.push(e)},then(e){return this.onEnd(e),this}}},loop(e,t){let i=null,n=T((()=>{i=this.wait(e,n),t()}),"newAction");return i=this.wait(0,n),{get paused(){return i.paused},set paused(e){i.paused=e},cancel:()=>i.cancel()}},tween(e,t,i,n,s=gt.linear){let r=0,o=[],a=this.onUpdate((()=>{r+=Ai();let l=Math.min(r/i,1);n(B(e,t,s(l))),1===l&&(a.cancel(),n(t),o.forEach((e=>e())))}));return{get paused(){return a.paused},set paused(e){a.paused=e},onEnd(e){o.push(e)},then(e){return this.onEnd(e),this},cancel(){a.cancel()},finish(){a.cancel(),n(t),o.forEach((e=>e()))}}}}}T(tn,"offscreen"),T(nn,"isFixed"),T(sn,"area"),T(rn,"getRenderProps"),T(on,"sprite"),T(an,"text"),T(ln,"polygon"),T(hn,"rect"),T(un,"uvquad"),T(dn,"circle"),T(cn,"outline"),T(pn,"timer");let fn;function gn(e={}){let t=null,i=null,n=!1;return{id:"body",require:["pos","area"],vel:new U(0),jumpForce:e.jumpForce??640,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(0===this.mass)throw new Error("Can't set body mass to 0");this.onCollideUpdate(((e,t)=>{if(e.is("body")&&!t.resolved&&(this.trigger("beforePhysicsResolve",t),e.trigger("beforePhysicsResolve",t.reverse()),!(t.resolved||this.isStatic&&e.isStatic))){if(this.isStatic||e.isStatic){let i=!this.isStatic&&e.isStatic?t:t.reverse();i.source.pos=i.source.pos.add(i.displacement),i.source.transform=Ri(i.source)}else{let i=this.mass+e.mass;this.pos=this.pos.add(t.displacement.scale(e.mass/i)),e.pos=e.pos.add(t.displacement.scale(-this.mass/i)),this.transform=Ri(this),e.transform=Ri(e)}t.resolved=!0,this.trigger("physicsResolve",t),e.trigger("physicsResolve",t.reverse())}})),this.onPhysicsResolve((e=>{V.gravity&&(e.isBottom()&&this.isFalling()?(this.vel.y=0,t=e.target,i=e.target.pos,n?n=!1:this.trigger("ground",t)):e.isTop()&&this.isJumping()&&(this.vel.y=0,this.trigger("headbutt",e.target)))}))},update(){if(!V.gravity||this.isStatic)return;if(n&&(t=null,i=null,this.trigger("fallOff"),n=!1),t){if(this.isColliding(t)&&t.exists()&&t.is("body"))return!t.pos.eq(i)&&!1!==e.stickToPlatform&&this.moveBy(t.pos.sub(i)),void(i=t.pos);n=!0}let s=this.vel.y;this.vel.y+=V.gravity*this.gravityScale*Ai(),this.vel.y=Math.min(this.vel.y,e.maxVelocity??65536),s<0&&this.vel.y>=0&&this.trigger("fall"),this.move(this.vel)},onPhysicsResolve(e){return this.on("physicsResolve",e)},onBeforePhysicsResolve(e){return this.on("beforePhysicsResolve",e)},curPlatform:()=>t,isGrounded:()=>null!==t,isFalling(){return this.vel.y>0},isJumping(){return this.vel.y<0},jump(e){t=null,i=null,this.vel.y=-e||-this.jumpForce},onGround(e){return this.on("ground",e)},onFall(e){return this.on("fall",e)},onFallOff(e){return this.on("fallOff",e)},onHeadbutt(e){return this.on("headbutt",e)}}}function mn(e=2){let t=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround((()=>{t=this.numJumps}))},doubleJump(e){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(e))},onDoubleJump(e){return this.on("doubleJump",e)},inspect:()=>`${t}`}}function wn(e,t){return{id:"shader",shader:e,..."function"==typeof t?{uniform:t(),update(){this.uniform=t()}}:{uniform:t}}}function yn(){return{id:"fixed",fixed:!0}}function An(e){return{id:"stay",stay:!0,scenesToStay:e}}function vn(e,t){if(null==e)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(t=1){this.setHP(e-t),this.trigger("hurt",t)},heal(t=1){let i=e;this.setHP(e+t),this.trigger("heal",e-i)},hp:()=>e,maxHP:()=>t??null,setMaxHP(e){t=e},setHP(i){(e=t?Math.min(t,i):i)<=0&&this.trigger("death")},onHurt(e){return this.on("hurt",e)},onHeal(e){return this.on("heal",e)},onDeath(e){return this.on("death",e)},inspect:()=>`${e}`}}function Vn(e,t={}){if(null==e)throw new Error("lifespan() requires time");let i=t.fade??0;return{id:"lifespan",async add(){await Yn(e),i>0&&this.opacity&&await Qn(this.opacity,0,i,(e=>this.opacity=e),gt.linear),this.destroy()}}}function bn(e,t,i){if(!e)throw new Error("state() requires an initial state");let n={};function s(e){n[e]||(n[e]={enter:new we,end:new we,update:new we,draw:new we})}function r(e,t,i){return s(t),n[t][e].add(i)}function o(e,t,...i){s(t),n[t][e].trigger(...i)}T(s,"initStateEvents"),T(r,"on"),T(o,"trigger");let a=!1;return{id:"state",state:e,enterState(e,...n){if(a=!0,t&&!t.includes(e))throw new Error(`State not found: ${e}`);let s=this.state;if(i){if(!(null==i?void 0:i[s]))return;let t="string"==typeof i[s]?[i[s]]:i[s];if(!t.includes(e))throw new Error(`Cannot transition state from "${s}" to "${e}". Available transitions: ${t.map((e=>`"${e}"`)).join(", ")}`)}o("end",s,...n),this.state=e,o("enter",e,...n),o("enter",`${s} -> ${e}`,...n)},onStateTransition:(e,t,i)=>r("enter",`${e} -> ${t}`,i),onStateEnter:(e,t)=>r("enter",e,t),onStateUpdate:(e,t)=>r("update",e,t),onStateDraw:(e,t)=>r("draw",e,t),onStateEnd:(e,t)=>r("end",e,t),update(){a||(o("enter",e),a=!0),o("update",this.state)},draw(){o("draw",this.state)},inspect(){return this.state}}}function xn(e=1){let t=0,i=!1;return{require:["opacity"],add(){this.opacity=0},update(){i||(t+=Ai(),this.opacity=C(t,0,e,0,1),t>=e&&(this.opacity=1,i=!0))}}}function En(e="intersect"){return{id:"mask",mask:e}}function Sn(e){return{add(){this.canvas=e}}}function Rn(e){A.loaded?e():V.events.on("load",e)}function kn(e,t){V.scenes[e]=t}function Tn(e,...t){if(!V.scenes[e])throw new Error(`Scene not found: ${e}`);V.events.onOnce("frameEnd",(()=>{V.events.trigger("sceneLeave",e),h.events.clear(),V.events.clear(),V.objEvents.clear(),[...V.root.children].forEach((t=>{(!t.stay||t.scenesToStay&&!t.scenesToStay.includes(e))&&V.root.remove(t)})),V.root.clearEvents(),fs(),V.cam={pos:null,scale:N(1),angle:0,shake:0,transform:new j},V.scenes[e](...t)}))}function Mn(e){return V.events.on("sceneLeave",e)}function In(e,t){try{return JSON.parse(window.localStorage[e])}catch{return t?(Dn(e,t),t):null}}function Dn(e,t){window.localStorage[e]=JSON.stringify(t)}function Pn(t,...i){let n,s=t(gs);n="function"==typeof s?s(...i)(gs):s;for(let r in n)gs[r]=n[r],!1!==e.global&&(window[r]=n[r]);return gs}function Bn(){return N(ci()/2,pi()/2)}var Cn;function Fn(e={}){let t=N(0),i=e.isObstacle??!1,n=e.cost??0,s=e.edges??[],r=T((()=>{let e={left:1,top:2,right:4,bottom:8};return s.map((t=>e[t]||0)).reduce(((e,t)=>e|t),0)}),"getEdgeMask"),o=r();return{id:"tile",tilePosOffset:e.offset??N(0),set tilePos(e){let i=this.getLevel();t=e.clone(),this.pos=N(this.tilePos.x*i.tileWidth(),this.tilePos.y*i.tileHeight()).add(this.tilePosOffset)},get tilePos(){return t},set isObstacle(e){i!==e&&(i=e,this.getLevel().invalidateNavigationMap())},get isObstacle(){return i},set cost(e){n!==e&&(n=e,this.getLevel().invalidateNavigationMap())},get cost(){return n},set edges(e){s=e,o=r(),this.getLevel().invalidateNavigationMap()},get edges(){return s},get edgeMask(){return o},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(N(-1,0))},moveRight(){this.tilePos=this.tilePos.add(N(1,0))},moveUp(){this.tilePos=this.tilePos.add(N(0,-1))},moveDown(){this.tilePos=this.tilePos.add(N(0,1))}}}function Un(e,t){if(!t.tileWidth||!t.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let i=qn([Yi(t.pos??N(0))]),n=e.length,s=0,r=null,o=null,a=null,l=null,h=T((e=>e.x+e.y*s),"tile2Hash"),u=T((e=>N(Math.floor(e%s),Math.floor(e/s))),"hash2Tile"),d=T((()=>{r=[];for(let e of i.children)c(e)}),"createSpatialMap"),c=T((e=>{let t=h(e.tilePos);r[t]?r[t].push(e):r[t]=[e]}),"insertIntoSpatialMap"),p=T((e=>{let t=h(e.tilePos);if(r[t]){let i=r[t].indexOf(e);i>=0&&r[t].splice(i,1)}}),"removeFromSpatialMap"),f=T((()=>{let e=!1;for(let t of i.children){let n=i.pos2Tile(t.pos);(t.tilePos.x!=n.x||t.tilePos.y!=n.y)&&(e=!0,p(t),t.tilePos.x=n.x,t.tilePos.y=n.y,c(t))}e&&i.trigger("spatial_map_changed")}),"updateSpatialMap"),g=T((()=>{let e=i.getSpatialMap(),t=i.numRows()*i.numColumns();o?o.length=t:o=new Array(t),o.fill(1,0,t);for(let i=0;i<e.length;i++){let t=e[i];if(t){let e=0;for(let i of t){if(i.isObstacle){e=1/0;break}e+=i.cost}o[i]=e||1}}}),"createCostMap"),m=T((()=>{let e=i.getSpatialMap(),t=i.numRows()*i.numColumns();a?a.length=t:a=new Array(t),a.fill(15,0,t);for(let i=0;i<e.length;i++){let t=e[i];if(t){let e=t.length,n=15;for(let i=0;i<e;i++)n|=t[i].edgeMask;a[i]=n}}}),"createEdgeMap"),w=T((()=>{let e=i.numRows()*i.numColumns(),t=T(((e,t)=>{let i=[];for(i.push(e);i.length>0;){let e=i.pop();v(e).forEach((e=>{l[e]<0&&(l[e]=t,i.push(e))}))}}),"traverse");l?l.length=e:l=new Array(e),l.fill(-1,0,e);let n=0;for(let i=0;i<o.length;i++)l[i]>=0||t(i,n),n++}),"createConnectivityMap"),y=T(((e,t)=>o[t]),"getCost"),A=T(((e,t)=>{let i=u(e),n=u(t);return i.dist(n)}),"getHeuristic"),v=T(((e,t)=>{let i=[],r=Math.floor(e%s),l=r>0&&1&a[e]&&o[e-1]!==1/0,h=e>=s&&2&a[e]&&o[e-s]!==1/0,u=r<s-1&&4&a[e]&&o[e+1]!==1/0,d=e<s*n-s-1&&8&a[e]&&o[e+s]!==1/0;return t?(l&&(h&&i.push(e-s-1),i.push(e-1),d&&i.push(e+s-1)),h&&i.push(e-s),u&&(h&&i.push(e-s+1),i.push(e+1),d&&i.push(e+s+1)),d&&i.push(e+s)):(l&&i.push(e-1),h&&i.push(e-s),u&&i.push(e+1),d&&i.push(e+s)),i}),"getNeighbours"),V={id:"level",tileWidth:()=>t.tileWidth,tileHeight:()=>t.tileHeight,spawn(e,...n){let s=N(...n),o=(()=>{if("string"!=typeof e){if(Array.isArray(e))return e;throw new Error("Expected a symbol or a component list")}if(t.tiles[e]){if("function"!=typeof t.tiles[e])throw new Error("Level symbol def must be a function returning a component list");return t.tiles[e](s)}if(t.wildcardTile)return t.wildcardTile(e,s)})();if(!o)return null;let a=!1,l=!1;for(let t of o)"tile"===t.id&&(l=!0),"pos"===t.id&&(a=!0);a||o.push(Yi()),l||o.push(Fn());let h=i.add(o);return a&&(h.tilePosOffset=h.pos.clone()),h.tilePos=s,r&&(c(h),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),h},numColumns:()=>s,numRows:()=>n,levelWidth(){return s*this.tileWidth()},levelHeight(){return n*this.tileHeight()},tile2Pos(...e){return N(...e).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...e){let t=N(...e);return N(Math.floor(t.x/this.tileWidth()),Math.floor(t.y/this.tileHeight()))},getSpatialMap:()=>(r||d(),r),onSpatialMapChanged(e){return this.on("spatial_map_changed",e)},onNavigationMapInvalid(e){return this.on("navigation_map_invalid",e)},getAt(e){r||d();let t=h(e);return r[t]||[]},update(){r&&f()},invalidateNavigationMap(){o=null,a=null,l=null},onNavigationMapChanged(e){return this.on("navigation_map_changed",e)},getTilePath(e,t,i={}){var r;if(o||g(),a||m(),l||w(),e.x<0||e.x>=s||e.y<0||e.y>=n||t.x<0||t.x>=s||t.y<0||t.y>=n)return null;let d=h(e),c=h(t);if(o[c]===1/0)return null;if(d===c)return[];if(-1!=l[d]&&l[d]!==l[c])return null;let p=new De(((e,t)=>e.cost<t.cost));p.insert({cost:0,node:d});let f=new Map;f.set(d,d);let V=new Map;for(V.set(d,0);0!==p.length;){let e=null==(r=p.remove())?void 0:r.node;if(e===c)break;let t=v(e,i.allowDiagonals);for(let i of t){let t=(V.get(e)||0)+y(e,i)+A(i,c);(!V.has(i)||t<V.get(i))&&(V.set(i,t),p.insert({cost:t,node:i}),f.set(i,e))}}let b=[],x=c,E=u(x);for(b.push(E);x!==d;){x=f.get(x);let e=u(x);b.push(e)}return b.reverse()},getPath(e,t,i={}){let n=this.tileWidth(),s=this.tileHeight(),r=this.getTilePath(this.pos2Tile(e),this.pos2Tile(t),i);return r?[e,...r.slice(1,-1).map((e=>e.scale(n,s).add(n/2,s/2))),t]:null}};return i.use(V),i.onNavigationMapInvalid((()=>{i.invalidateNavigationMap(),i.trigger("navigation_map_changed")})),e.forEach(((e,t)=>{let n=e.split("");s=Math.max(n.length,s),n.forEach(((e,n)=>{i.spawn(e,N(n,t))}))})),i}function Nn(e={}){let t=null,i=null,n=null,s=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation:()=>i&&n?i[n]:null,getPath:()=>i?i.slice():null,getTarget:()=>t,isNavigationFinished:()=>!i||null===n,isTargetReachable:()=>null!==i,isTargetReached(){return!t||this.pos.eq(t)},setTarget(e){t=e,i=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),n=i?0:null,i?(s||(s=this.getLevel().onNavigationMapChanged((()=>{i&&null!==n&&(i=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),n=i?0:null,i?this.trigger("navigation-next",this,i[n]):this.trigger("navigation-ended",this))})),this.onDestroy((()=>s.cancel()))),this.trigger("navigation-started",this),this.trigger("navigation-next",this,i[n])):this.trigger("navigation-ended",this)},update(){if(i&&null!==n){if(this.pos.sdist(i[n])<2){if(n===i.length-1)return this.pos=t.clone(),n=null,this.trigger("navigation-ended",this),void this.trigger("target-reached",this);n++,this.trigger("navigation-next",this,i[n])}this.moveTo(i[n],this.agentSpeed)}},onNavigationStarted(e){return this.on("navigation-started",e)},onNavigationNext(e){return this.on("navigation-next",e)},onNavigationEnded(e){return this.on("navigation-ended",e)},onTargetReached(e){return this.on("target-reached",e)},inspect:()=>JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(i)})}}function Ln(e){let t=h.canvas.captureStream(e),i=y.ctx.createMediaStreamDestination();y.masterNode.connect(i);let n=new MediaRecorder(t),s=[];return n.ondataavailable=e=>{e.data.size>0&&s.push(e.data)},n.onerror=()=>{y.masterNode.disconnect(i),t.getTracks().forEach((e=>e.stop()))},n.start(),{resume(){n.resume()},pause(){n.pause()},stop:()=>(n.stop(),y.masterNode.disconnect(i),t.getTracks().forEach((e=>e.stop())),new Promise((e=>{n.onstop=()=>{e(new Blob(s,{type:"video/mp4"}))}}))),download(e="kaboom.mp4"){this.stop().then((t=>Se(e,t)))}}}function On(){return document.activeElement===h.canvas}function Gn(e){e.destroy()}T(gn,"body"),T(mn,"doubleJump"),T(wn,"shader"),T(yn,"fixed"),T(An,"stay"),T(vn,"health"),T(Vn,"lifespan"),T(bn,"state"),T(xn,"fadeIn"),T(En,"mask"),T(Sn,"drawon"),T(Rn,"onLoad"),T(kn,"scene"),T(Tn,"go"),T(Mn,"onSceneLeave"),T(In,"getData"),T(Dn,"setData"),T(Pn,"plug"),T(Bn,"center"),(Cn=fn||(fn={}))[Cn.None=0]="None",Cn[Cn.Left=1]="Left",Cn[Cn.Top=2]="Top",Cn[Cn.LeftTop=3]="LeftTop",Cn[Cn.Right=4]="Right",Cn[Cn.Horizontal=5]="Horizontal",Cn[Cn.RightTop=6]="RightTop",Cn[Cn.HorizontalTop=7]="HorizontalTop",Cn[Cn.Bottom=8]="Bottom",Cn[Cn.LeftBottom=9]="LeftBottom",Cn[Cn.Vertical=10]="Vertical",Cn[Cn.LeftVertical=11]="LeftVertical",Cn[Cn.RightBottom=12]="RightBottom",Cn[Cn.HorizontalBottom=13]="HorizontalBottom",Cn[Cn.RightVertical=14]="RightVertical",Cn[Cn.All=15]="All",T(Fn,"tile"),T(Un,"addLevel"),T(Nn,"agent"),T(Ln,"record"),T(On,"isFocused"),T(Gn,"destroy");let qn=V.root.add.bind(V.root),Kn=V.root.readd.bind(V.root),jn=V.root.removeAll.bind(V.root),Hn=V.root.get.bind(V.root),Yn=V.root.wait.bind(V.root),zn=V.root.loop.bind(V.root),Qn=V.root.tween.bind(V.root);function Xn(e=2,t=1){let i=0;return{require:["scale"],update(){let n=Math.sin(i*e)*t;n<0&&this.destroy(),this.scale=N(n),i+=Ai()}}}T(Xn,"boom");let Jn=Ae(null,"data:image/png;base64,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"),Wn=Ae(null,"data:image/png;base64,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");function Zn(e,t={}){let i=qn([Yi(e),An()]),n=5*(t.speed||1),s=t.scale||1;i.add([on(Wn),zi(0),Zi("center"),Xn(n,s),...t.comps??[]]);let r=i.add([on(Jn),zi(0),Zi("center"),pn(),...t.comps??[]]);return r.wait(.4/n,(()=>r.use(Xn(n,s)))),r.onDestroy((()=>i.destroy())),i}function _n(){V.root.update()}T(Zn,"addKaboom"),T(_n,"updateFrame");const $n=class e{constructor(e,t,i,n=!1){R(this,"source"),R(this,"target"),R(this,"displacement"),R(this,"resolved",!1),this.source=e,this.target=t,this.displacement=i,this.resolved=n}reverse(){return new e(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}};T($n,"Collision");let es=$n;function ts(){let t={},i=e.hashGridSize||64,n=new j,s=[];function r(e){if(s.push(n.clone()),e.pos&&n.translate(e.pos),e.scale&&n.scale(e.scale),e.angle&&n.rotate(e.angle),e.transform=n.clone(),e.c("area")&&!e.paused){let n=e,s=n.worldArea().bbox(),r=Math.floor(s.pos.x/i),o=Math.floor(s.pos.y/i),a=Math.ceil((s.pos.x+s.width)/i),l=Math.ceil((s.pos.y+s.height)/i),h=new Set;for(let e=r;e<=a;e++)for(let i=o;i<=l;i++)if(t[e])if(t[e][i]){let s=t[e][i];e:for(let e of s){if(e.paused||!e.exists()||h.has(e.id))continue;for(let i of n.collisionIgnore)if(e.is(i))continue e;for(let i of e.collisionIgnore)if(n.is(i))continue e;let t=fe(n.worldArea(),e.worldArea());if(t){let i=new es(n,e,t);n.trigger("collideUpdate",e,i);let s=i.reverse();s.resolved=i.resolved,e.trigger("collideUpdate",n,s)}h.add(e.id)}s.push(n)}else t[e][i]=[n];else t[e]={},t[e][i]=[n]}e.children.forEach(r),n=s.pop()}T(r,"checkObj"),r(V.root)}function is(){let e=V.cam,t=U.fromAngle(J(0,360)).scale(e.shake);e.shake=B(e.shake,0,5*Ai()),e.transform=(new j).translate(Bn()).scale(e.scale).rotate(e.angle).translate((e.pos??Bn()).scale(-1).add(t)),V.root.draw(),pt()}function ns(){let e=x();V.events.numListeners("loading")>0?V.events.trigger("loading",e):si((()=>{let t=ci()/2,i=N(ci()/2,pi()/2).sub(N(t/2,12));Qt({pos:N(0),width:ci(),height:pi(),color:O(0,0,0)}),Qt({pos:i,width:t,height:24,fill:!1,outline:{width:4}}),Qt({pos:i,width:t*e,height:24})}))}function ss(e,t){si((()=>{let i=N(8);qt(),Lt(e);let n=hi({text:t,font:vt,size:16,pos:i,color:O(255,255,255),fixed:!0}),s=n.width+2*i.x,r=n.height+2*i.x;e.x+s>=ci()&&Lt(N(-s,0)),e.y+r>=pi()&&Lt(N(0,-r)),Qt({width:s,height:r,color:O(0,0,0),radius:4,opacity:.8,fixed:!0}),di(n),Kt()}))}function rs(){if(yi.inspect){let e=null;for(let t of V.root.get("*",{recursive:!0}))if(t.c("area")&&t.isHovering()){e=t;break}if(V.root.drawInspect(),e){let t=[],i=e.inspect();for(let e in i)i[e]?t.push(`${e}: ${i[e]}`):t.push(`${e}`);ss(gi(mi()),t.join("\n"))}ss(N(8),`FPS: ${yi.fps()}`)}yi.paused&&si((()=>{qt(),Lt(ci(),0),Lt(-8,8);Qt({width:32,height:32,anchor:"topright",color:O(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)Qt({width:4,height:19.2,anchor:"center",pos:N(-32/3*e,16),color:O(255,255,255),radius:2,fixed:!0});Kt()})),1!==yi.timeScale&&si((()=>{qt(),Lt(ci(),pi()),Lt(-8,-8);let e=hi({text:yi.timeScale.toFixed(1),font:vt,size:16,color:O(255,255,255),pos:N(-8),anchor:"botright",fixed:!0});Qt({width:e.width+16+32,height:e.height+16,anchor:"botright",color:O(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=0;t<2;t++){let i=yi.timeScale<1;Wt({p1:N(-e.width-8*(i?2:3.5),-8),p2:N(-e.width-8*(i?2:3.5),-8-e.height),p3:N(-e.width-8*(i?3.5:2),-8-e.height/2),pos:N(8*-t*1+(i?-4:0),0),color:O(255,255,255),fixed:!0})}di(e),Kt()})),yi.curRecording&&si((()=>{qt(),Lt(0,pi()),Lt(24,-24),Zt({radius:12,color:O(255,0,0),opacity:H(0,1,4*h.time()),fixed:!0}),Kt()})),yi.showLog&&V.logs.length>0&&si((()=>{var t;qt(),Lt(0,pi()),Lt(8,-8);let i=[];for(let e of V.logs){let n="",s=e.msg instanceof Error?"error":"info";n+=`[time]${e.time.toFixed(2)}[/time]`,n+=" ",n+=`[${s}]${(null==(t=e.msg)?void 0:t.toString)?e.msg.toString():e.msg}[/${s}]`,i.push(n)}V.logs=V.logs.filter((t=>h.time()-t.time<(e.logTime||4)));let n=hi({text:i.join("\n"),font:vt,pos:N(8,-8),anchor:"botleft",size:16,width:.6*ci(),lineSpacing:4,fixed:!0,styles:{time:{color:O(127,127,127)},info:{color:O(255,255,255)},error:{color:O(255,0,127)}}});Qt({width:n.width+16,height:n.height+16,anchor:"botleft",color:O(0,0,0),radius:4,opacity:.8,fixed:!0}),di(n),Kt()}))}function os(e){V.events.on("loading",e)}function as(e){h.onResize(e)}function ls(e){V.events.on("error",e)}function hs(e){console.error(e),y.ctx.suspend(),h.run((()=>{ft(),si((()=>{let t=ci(),i=pi(),n={size:36,width:t-64,letterSpacing:4,lineSpacing:4,font:vt,fixed:!0};Qt({width:t,height:i,color:O(0,0,255),fixed:!0});let s=hi({...n,text:"Error",pos:N(32),color:O(255,128,0),fixed:!0});di(s),ui({...n,text:e.message,pos:N(32,32+s.height+16),fixed:!0}),Kt(),V.events.trigger("error",e)})),Ft()}))}function us(e){u.push(e)}function ds(){V.events.onOnce("frameEnd",(()=>{h.quit(),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT);let e=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<e;t++)d.activeTexture(d.TEXTURE0+t),d.bindTexture(d.TEXTURE_2D,null),d.bindTexture(d.TEXTURE_CUBE_MAP,null);d.bindBuffer(d.ARRAY_BUFFER,null),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null),d.bindRenderbuffer(d.RENDERBUFFER,null),d.bindFramebuffer(d.FRAMEBUFFER,null),c.destroy(),u.forEach((e=>e()))}))}T(ts,"checkFrame"),T(is,"drawFrame"),T(ns,"drawLoadScreen"),T(ss,"drawInspectText"),T(rs,"drawDebug"),T(os,"onLoading"),T(as,"onResize"),T(ls,"onError"),T(hs,"handleErr"),T(us,"onCleanup"),T(ds,"quit");let cs=!0;function ps(){let t=o,i=d.drawingBufferWidth/t,n=d.drawingBufferHeight/t;if(e.letterbox){if(!e.width||!e.height)throw new Error("Letterboxing requires width and height defined.");let t=i/n,s=e.width/e.height;if(t>s){let e=n*s,t=(i-e)/2;p.viewport={x:t,y:0,width:e,height:n}}else{let e=i/s,t=(n-e)/2;p.viewport={x:0,y:t,width:i,height:e}}}else{if(e.stretch&&(!e.width||!e.height))throw new Error("Stretching requires width and height defined.");p.viewport={x:0,y:0,width:i,height:n}}}function fs(){h.onHide((()=>{e.backgroundAudio||y.ctx.suspend()})),h.onShow((()=>{!e.backgroundAudio&&!yi.paused&&y.ctx.resume()})),h.onResize((()=>{if(h.isFullscreen())return;let t=e.width&&e.height;t&&!e.stretch&&!e.letterbox||(i.width=i.offsetWidth*o,i.height=i.offsetHeight*o,ps(),t||(p.frameBuffer.free(),p.frameBuffer=new _e(c,d.drawingBufferWidth,d.drawingBufferHeight),p.width=d.drawingBufferWidth/o,p.height=d.drawingBufferHeight/o))})),!1!==e.debug&&(h.onKeyPress("f1",(()=>yi.inspect=!yi.inspect)),h.onKeyPress("f2",(()=>yi.clearLog())),h.onKeyPress("f8",(()=>yi.paused=!yi.paused)),h.onKeyPress("f7",(()=>{yi.timeScale=Ji(P(yi.timeScale-.2,0,2),1)})),h.onKeyPress("f9",(()=>{yi.timeScale=Ji(P(yi.timeScale+.2,0,2),1)})),h.onKeyPress("f10",(()=>yi.stepFrame()))),e.burp&&h.onKeyPress("b",(()=>tt()))}h.run((()=>{try{A.loaded||1===x()&&!cs&&(A.loaded=!0,V.events.trigger("load")),!A.loaded&&!1!==e.loadingScreen||cs?(ft(),ns(),Ft()):(yi.paused||_n(),ts(),ft(),is(),!1!==e.debug&&rs(),Ft()),cs&&(cs=!1),V.events.trigger("frameEnd")}catch(t){hs(t)}})),T(ps,"updateViewport"),T(fs,"initEvents"),ps(),fs();let gs={VERSION:"3000.1.17",loadRoot:E,loadProgress:x,loadSprite:Ae,loadSpriteAtlas:oe,loadSound:Ue,loadBitmapFont:Q,loadFont:Y,loadShader:Ce,loadShaderURL:Fe,loadAseprite:Pe,loadPedit:ve,loadBean:Ne,loadJSON:S,load:b,getSprite:Le,getSound:Oe,getFont:Ge,getBitmapFont:qe,getShader:Ke,getAsset:je,Asset:nt,SpriteData:g,SoundData:w,width:ci,height:pi,center:Bn,dt:Ai,time:h.time,screenshot:h.screenshot,record:Ln,isFocused:On,setCursor:h.setCursor,getCursor:h.getCursor,setCursorLocked:h.setCursorLocked,isCursorLocked:h.isCursorLocked,setFullscreen:h.setFullscreen,isFullscreen:h.isFullscreen,isTouchscreen:h.isTouchscreen,onLoad:Rn,onLoading:os,onResize:as,onGamepadConnect:h.onGamepadConnect,onGamepadDisconnect:h.onGamepadDisconnect,onError:ls,onCleanup:us,camPos:vi,camScale:Vi,camRot:bi,shake:xi,toScreen:Ei,toWorld:Si,setGravity:qi,getGravity:Ki,setBackground:ji,getBackground:Hi,getGamepads:h.getGamepads,add:qn,make:ki,destroy:Gn,destroyAll:jn,get:Hn,readd:Kn,pos:Yi,scale:zi,rotate:Qi,color:Xi,opacity:Wi,anchor:Zi,area:sn,sprite:on,text:an,polygon:ln,rect:hn,circle:dn,uvquad:un,outline:cn,body:gn,doubleJump:mn,shader:wn,timer:pn,fixed:yn,stay:An,health:vn,lifespan:Vn,z:_i,move:en,offscreen:tn,follow:$i,state:bn,fadeIn:xn,mask:En,drawon:Sn,tile:Fn,agent:Nn,on:Ti,onUpdate:Mi,onDraw:Ii,onAdd:Di,onDestroy:Pi,onClick:Ni,onCollide:Bi,onCollideUpdate:Ci,onCollideEnd:Fi,onHover:Li,onHoverUpdate:Oi,onHoverEnd:Gi,onKeyDown:h.onKeyDown,onKeyPress:h.onKeyPress,onKeyPressRepeat:h.onKeyPressRepeat,onKeyRelease:h.onKeyRelease,onMouseDown:h.onMouseDown,onMousePress:h.onMousePress,onMouseRelease:h.onMouseRelease,onMouseMove:h.onMouseMove,onCharInput:h.onCharInput,onTouchStart:h.onTouchStart,onTouchMove:h.onTouchMove,onTouchEnd:h.onTouchEnd,onScroll:h.onScroll,onHide:h.onHide,onShow:h.onShow,onGamepadButtonDown:h.onGamepadButtonDown,onGamepadButtonPress:h.onGamepadButtonPress,onGamepadButtonRelease:h.onGamepadButtonRelease,onGamepadStick:h.onGamepadStick,mousePos:mi,mouseDeltaPos:h.mouseDeltaPos,isKeyDown:h.isKeyDown,isKeyPressed:h.isKeyPressed,isKeyPressedRepeat:h.isKeyPressedRepeat,isKeyReleased:h.isKeyReleased,isMouseDown:h.isMouseDown,isMousePressed:h.isMousePressed,isMouseReleased:h.isMouseReleased,isMouseMoved:h.isMouseMoved,isGamepadButtonPressed:h.isGamepadButtonPressed,isGamepadButtonDown:h.isGamepadButtonDown,isGamepadButtonReleased:h.isGamepadButtonReleased,getGamepadStick:h.getGamepadStick,charInputted:h.charInputted,loop:zn,wait:Yn,play:Je,volume:Xe,burp:tt,audioCtx:y.ctx,Line:he,Rect:ue,Circle:de,Polygon:pe,Vec2:U,Color:L,Mat4:j,Quad:q,RNG:z,rand:J,randi:W,randSeed:X,vec2:N,rgb:O,hsl2rgb:G,quad:K,choose:_,chance:Z,lerp:B,tween:Qn,easings:gt,map:C,mapc:F,wave:H,deg2rad:I,rad2deg:D,clamp:P,testLineLine:te,testRectRect:$,testRectLine:ie,testRectPoint:ne,testCirclePolygon:ae,testLinePoint:se,testLineCircle:re,drawSprite:Yt,drawText:ui,formatText:hi,drawRect:Qt,drawLine:Xt,drawLines:Jt,drawTriangle:Wt,drawCircle:Zt,drawEllipse:_t,drawUVQuad:jt,drawPolygon:$t,drawFormattedText:di,drawMasked:ti,drawSubtracted:ii,pushTransform:qt,popTransform:Kt,pushTranslate:Lt,pushScale:Ot,pushRotate:Gt,pushMatrix:Nt,usePostEffect:Ct,makeCanvas:rt,debug:yi,scene:kn,go:Tn,onSceneLeave:Mn,addLevel:Un,getData:In,setData:Dn,download:be,downloadJSON:Ee,downloadText:xe,downloadBlob:Se,plug:Pn,ASCII_CHARS:yt,canvas:h.canvas,addKaboom:Zn,LEFT:U.LEFT,RIGHT:U.RIGHT,UP:U.UP,DOWN:U.DOWN,RED:L.RED,GREEN:L.GREEN,BLUE:L.BLUE,YELLOW:L.YELLOW,MAGENTA:L.MAGENTA,CYAN:L.CYAN,WHITE:L.WHITE,BLACK:L.BLACK,quit:ds,Event:we,EventHandler:ye,EventController:me};if(e.plugins&&e.plugins.forEach(Pn),!1!==e.global)for(let R in gs)window[R]=gs[R];return!1!==e.focus&&h.canvas.focus(),gs}),"default");const Ft=Ct({global:!1,touchToMouse:!0,canvas:document.getElementById("game"),backgroundAudio:!0}),Ut={pc:'This is my PC. I work mostly in JavaScript/TypeScript these days.\n    I\'ve made a couple of games in that language. I also like Golang and Python. Anyway regardless of the language, I just like programming.\n    Here is my <a href="https://github.com/jslegenddev" target="_blank">Github</a>!',"cs-degree":"This is my CS degree. I hung it on the wall because I'm proud of it. It was a very theoretical degree but I think it gave me a good foundation.","sofa-table":'That\'s my sofa. I like to relax here and watch YouTube. \n  I also make game programming tutorials on YouTube. Go sub to <a href="https://youtube.com/@jslegenddev" target="_blank">my channel</a>! (If you like the content)\n  You\'ll learn how I built this portfolio you\'re currently playing through!',tv:'That\'s my TV. I\'ve been watching tech youtubers a lot recently like :\n   <a href="https://www.youtube.com/@ThePrimeTimeagen" target="_blank">Theprimeagen</a>, <a href="https://www.youtube.com/@t3dotgg" target="_blank">Theo - t3.gg</a>,\n  <a href="https://www.youtube.com/@PirateSoftware" target="_blank">PirateSoftware</a> (sometimes) and <a href="https://www.youtube.com/@MelkeyDev" target="_blank">Melkey</a>!',bed:"This where I sleep. Great ideas comes when I'm lying on my bed. When an idea strikes, I often have to write it down or else I won't be able to sleep because my mental energy is consumed by it.",resume:'This is my desk and on it is my resume. <a href="https://github.com/JSLegendDev/Resume/blob/main/JSLegend%20Resume-1.pdf" target="_blank">Check it out?</a>\n  Contact me at jslegend@protonmail.com if you have any interesting job opportunities!',projects:'Info about this portfolio : It\'s made with the Kaboom.js library which is a library for making games in JavaScript.\n  Text is rendered with HTML/CSS. So the textbox you\'re currently reading is not rendered within canvas. Learn more about how to use\n  Kaboom.js by watching some of my tutorials <a href="https://youtube.com/@jslegenddev" target="_blank">here</a>.',library:"There are a lot of programming books on my shelves. There is even one in French (I also speak French btw).\n  I probably only read one of them. Who else compulsively buys technical books without ever finishing them?",exit:"If you want to exit JSLegendDev's portfolio, just close the tab."},Nt={1:"2023 holds the record for being the hottest year globally since NASA began satellite monitoring!}",2:"Since 1993, global sea levels have been rising at an average rate of 4.4 mm per year due to melting ice and thermal expansion.",3:"Carbon dioxide (CO₂) is the most significant greenhouse gas contributing to the Earth's temperature rise.",4:" Over 95% of global warming is directly linked to human actions like burning fossil fuels and deforestation.",5:"The Arctic is warming more than twice as fast as the global average, which is why its ice is melting so quickly.",6:"Global warming is causing Greenland to lose around 300 billion tons of ice every year—about the weight of 1,500 Empire State Buildings!",7:"NASA's OCO-2 satellite measures the global distribution of CO₂, helping scientists understand where carbon is coming from and where it's being absorbed.",8:"Since the start of the industrial age, atmospheric CO₂ levels have increased by 45%, driving climate change. ",9:"The Middle East and North Africa are experiencing more frequent extreme droughts, severely impacting water supplies.",10:"Climate change is shrinking habitats for many species, putting their survival at risk.",11:"About 90% of the excess heat from global warming is absorbed by the oceans, causing rising sea temperatures and threatening marine ecosystems",12:" Half of the world's coral reefs have already been lost due to rising sea temperatures and ocean acidification, which bleaches and weakens the corals.",13:" Climate change has extended the duration of wildfire seasons, especially in regions like the western United States, causing more intense and frequent fires.",14:"Global warming has led to a significant increase in the frequency and intensity of heatwaves, with major impacts on public health and agriculture.",15:" Antarctica and the Arctic are losing ice at unprecedented rates, with Antarctica alone shedding 150 billion metric tons of ice per year. ",16:"Climate change is affecting crop yields by altering growing seasons, reducing water availability, and increasing the likelihood of pests and diseases.",17:"As CO₂ levels increase in the atmosphere, more of it gets absorbed by the oceans, making the water more acidic and harming shellfish, corals, and other marine life.",18:" The frequency of extreme weather events, such as hurricanes, floods, and droughts, has increased due to climate change, affecting millions of people worldwide.",19:" Many species are being forced to migrate to new areas due to changing climate conditions, disrupting ecosystems and food chains. ",20:"As the Arctic warms, permafrost—ground that has been frozen for centuries—is thawing, releasing stored carbon dioxide and methane, which accelerates global warming.",heatwaves:"Have you noticed how heatwaves are becoming more frequent and intense? Global warming is affecting our public health in alarming ways. Cases of dehydration and heatstroke are on the rise, and the most vulnerable people are at risk.",record:"Did you know that 2023 was the hottest year on record since NASA started monitoring the climate with satellites? This is a clear sign that we need to act against climate change, or the future will be unsustainable.",crops:"The climate is changing, and that's a big problem for us. Changes in rainfall and temperature patterns are affecting our harvests. We are facing smaller harvests and more pests, and this impacts food security.",drought:"The situation in the Middle East and North Africa is critical. Extreme droughts are becoming more frequent, and water scarcity is a huge challenge for communities. We need sustainable solutions to manage our water resources. ",migration:"With climate change, many species are being forced to migrate to new habitats. This is creating an imbalance in ecosystems and food chains. We need to understand how these migrations are impacting the biodiversity that remains.",wildfires:"Wildfires are exacerbated by extreme drought, which is becoming more common in many parts of the world due to climate change. Regions such as the Middle East and North Africa are experiencing severe droughts more frequently, which drastically affects water resources and increases the risk of forest fires.",fires:"Fires, combined with global warming, are shrinking the natural habitats of many species, threatening global biodiversity. Species such as the kangaroo and koala in Australia, for example, are among the most vulnerable to frequent fires.",amazon:"The Amazon rainforest is increasingly releasing more carbon dioxide than it absorbs, due to deforestation and intense burning.",forest:"Forest fires in California and Australia have increased dramatically in recent decades, with 2020 being one of the worst years in terms of destruction caused by fire.",pollution:"The pollution generated by fires can travel thousands of kilometers, affecting even distant regions. This increases the number of cases of respiratory problems, especially among children and the elderly.",expansion:"Did you know that 50% of the rise in sea levels over the last 25 years is caused by thermal expansion? This is because, as the oceans warm up, the water expands, raising sea levels. This is one of the main reasons why we have so many coastal areas at risk.",vulnerability:"Rising sea levels don't affect all regions in the same way. Some areas are more vulnerable, especially small islands and coastal areas. Around 745 million people could face floods and cyclonic storms in the coming years... and all of this is becoming more and more frequent.",rise:"Since 1993, sea levels have risen by an average of 4.4 mm per year. It doesn't sound like much, but over time it's devastating. All this water comes from two main sources: melting polar ice and the thermal expansion of the oceans. It's a huge challenge to protect coastal cities.",warming:"Did you know that the oceans are absorbing 90% of the heat generated by global warming? This not only increases the temperature of the oceans, but also threatens entire ecosystems. Warmer waters are causing the death of many species and leaving corals completely vulnerable.",loss:"Half of the world's coral reefs have already been lost. Ocean warming and acidification are bleaching and weakening corals, which are the basis of many marine ecosystems. If we don't do something soon, corals could disappear completely, and that would have devastating impacts."},Lt=["Teacher - Good morning, students! How was your weekend?","Elon - Good morning, professor! The weekend was nice, but it was so hot and dry that my eyes and throat felt irritated.","Teacher - I know. The temperatures have been extremely high, and the air quality is really poor due to the lack of rain. That’s why today we’re going to study how human activities have impacted the global climate, and the greenhouse effect on Earth, which is causing global warming. But first, let’s understand a bit about what the greenhouse effect is.","Teacher - The greenhouse effect is a natural process that keeps the heat from the sun trapped at the Earth's surface, raising the average temperature of our planet. Imagine Earth as a greenhouse for plants. Sunlight enters the atmosphere, heats the surface, and some of that heat escapes back into space. However, certain gases in the atmosphere, like carbon dioxide, methane, ozone, and nitrous oxide, trap some of that heat. These gases, called greenhouse gases, act like the glass of a greenhouse, letting sunlight in but keeping the heat from escaping.","Elon - But professor, isn’t it bad to increase the Earth’s temperature?","Teacher - In balance, no. The natural greenhouse effect keeps Earth warm enough for life to exist. The problem is that we are releasing much more of these greenhouse gases. Since the start of the industrial age, atmospheric CO₂ levels have increased by 45%. Over 95% of global warming is directly linked to human actions, like burning fossil fuels and deforestation. This excess of gases increases the warming, leading to climate change. Right now, carbon dioxide (CO₂) is the most significant greenhouse gas contributing to Earth’s rising temperature. Due to its importance, NASA's OCO-2 satellite monitors the global distribution of CO₂, helping scientists track where carbon is being emitted and where it is being absorbed.","Elon - Oh! So the problem is that we’re 'trapping' too much heat by releasing more and more of these gases into the atmosphere?","Teacher - Exactly! And that’s causing the polar ice caps to melt, sea levels to rise, and extreme weather events to become more frequent. To help us understand the consequences better, I’ve brought some ultra-advanced augmented reality immersion devices that will transport us to scenarios of extreme climate events! The devices are already on each of your desks.","Elon - Whoa, that’s awesome!","Teacher - The first extreme climate event we’ll explore is the melting of the polar ice caps, caused by rising temperatures at the poles. Did you know that the Arctic is warming more than twice as fast as the global average? That’s why its ice is melting so quickly. The poles are among the most affected regions by global warming. Now, let’s explore this reality up close! Equip your devices!"],Ot=["Teacher - Welcome to the polar bears' home, one of the coldest and most beautiful places on the planet. Here, ice reigns, holding 70% of the freshwater needed to sustain human life.","Teacher - But the climate is changing... and soon this balance will be threatened.","Mission - The Arctic is warming more than twice as fast as the global average, causing the ice to melt rapidly. Reach the other side of the map, but be careful not to fall into the icy waters!"],Gt=["The melting of the glaciers was only the beginning. The impact is spreading around the world, and sea levels continue to rise. Now, in a new form, you'll have to face this next threat."],qt=["Teacher - Now that you've faced the melting glaciers in the Arctic, let's explore one of the main consequences of this process: sea level rise.","Teacher - Sea level rise is caused by two main factors. The first is the melting of glaciers and polar ice caps, which adds more water to the oceans. The second is thermal expansion – when ocean water warms, it expands, taking up more space.","Teacher - Both factors are linked to global warming, and the consequences are serious. Coastal cities, islands, and even large urban areas, like this one, are at risk of being submerged."],Kt=["Mission - Watch out! It looks like a flood is about to start. Escape to the top of the building!"],jt=["Elon - Whew! That was a close one!","After surviving the dangers of the rising waters, a new threat looms in the forests. Be prepared to face this new challenge."],Ht=["Teacher - You've survived the threat of rising waters, but now a new crisis is looming. As the world heats up, it's not just the waters that are in danger... fire is consuming the forests.","Teacher - The forests are becoming mazes of fire and ash. Your challenge now is to go through a world consumed by forest fires and learn how global warming is turning the planet's lungs into ashes."],Yt=["Teacher - After experiencing melting glaciers in the Arctic, rising sea levels in cities and forest fires. Now we face the challenges that come with water scarcity. With the increasing frequency of droughts, agriculture is at risk and many ecosystems are disintegrating.","Teacher - To avoid dying of dehydration, be prepared to find water in a desert that once flourished with life."],zt=["Congratulations! You've made it through all four challenges caused by global warming. I hope you've learned a lot from this experience. Now remove the devices."],Qt=["Teacher - So, everyone! How was the experience of exploring and learning more about each of these four extreme weather events?","Elon - It was a lot of fun, teacher! I learned things I never imagined about how global warming is affecting our planet.","Teacher - I'm glad to hear that! You faced heat waves, droughts, glacier melt, rising sea levels, and wildfires. Now it's time to see how much you really absorbed.","Teacher - We're going to have a test on everything we've covered during these challenges. You'll have the chance to show everything you've learned about how global warming is impacting our planet and how we, humans, are responsible for these changes.","Elon - A test? After this adventure, I'm more than ready!","Teacher - That's the spirit, Elon! The experience was just the beginning. Now it's time to solidify this knowledge and prepare ourselves for the future, because, as we've seen, understanding climate change and what we can do to mitigate it is crucial for the future survival of life on planet Earth.","Elon - Absolutely, teacher. I'm ready!"];function Xt(e,t){const i=document.getElementById("textbox-container"),n=document.getElementById("dialogue"),s=document.getElementById("close");i.style.display="block";let r=0,o="";const a=setInterval((()=>{if(r<e.length)return o+=e[r],n.innerHTML=o,void r++;clearInterval(a)}),5);s.addEventListener("click",(function e(){t(),i.style.display="none",n.innerHTML="",clearInterval(a),s.removeEventListener("click",e)}))}function Jt(e,t){const i=document.getElementById("conversation-container"),n=document.getElementById("conversation-dialogue"),s=document.getElementById("next");i.style.display="block";let r=0;function o(e){let t=0,i="";const s=setInterval((()=>{if(t<e.length)return i+=e[t],n.innerHTML=i,void t++;clearInterval(s)}),5)}r<e.length&&o(e[r]),s.addEventListener("click",(function(){if(n.innerHTML="",r++,r===e.length)return i.style.display="none",n.innerHTML="",void t();r<e.length&&o(e[r])}))}function Wt(e){e.width()/e.height()<1?e.camScale(e.vec2(1)):e.camScale(e.vec2(1.5))}var Zt;(Zt=Ft).loadSound("hit","./assets/audios/buzzer.mp3"),Zt.loadSprite("spritesheet","./assets/game/spritesheet.png",{sliceX:39,sliceY:31,anims:{"idle-down":936,"walk-down":{from:936,to:939,loop:!0,speed:8},"idle-side":975,"walk-side":{from:975,to:978,loop:!0,speed:8},"idle-up":1014,"walk-up":{from:1014,to:1017,loop:!0,speed:8}}}),Zt.loadSprite("map","./assets/game/map.png"),Zt.loadSprite("cat-map","./assets/game/cat-level-map.png"),Zt.loadSprite("parking","./assets/game/parking.png"),Zt.loadSprite("cats","./assets/game/cats.png",{sliceX:9,sliceY:6,anims:{"idle-up":8,"walk-up":{from:0,to:7,loop:!0,speed:8},"idle-down":{from:45,to:53,loop:!0,speed:8},"walk-down":{from:9,to:16,loop:!0,speed:8},"idle-side":{from:27,to:35,loop:!0,speed:8},"walk-side":{from:18,to:25,loop:!0,speed:8},jump:40}}),Zt.loadSprite("water","./assets/game/water.png"),Zt.loadSprite("classroom-map","./assets/game/classroom.png"),Zt.loadSprite("desert-map","./assets/game/desert-map.png"),Zt.loadSprite("foxes","./assets/game/foxes.png",{sliceX:3,sliceY:3,anims:{"idle-down":1,"walk-down":{from:0,to:2,loop:!0,speed:8},"idle-up":7,"walk-up":{from:6,to:8,loop:!0,speed:8},"idle-side":4,"walk-side":{from:3,to:5,loop:!0,speed:8}}}),Zt.loadSprite("forest","./assets/game/maze-of-trees.png"),Zt.loadSprite("trees","./assets/game/trees.png",{sliceX:7,sliceY:2,anims:{"tree-1":{from:0,to:6,loop:!0,speed:8},"tree-2":{from:7,to:13,loop:!0,speed:8}}}),Zt.loadSprite("birds","./assets/game/birds.png",{sliceX:4,sliceY:1,anims:{fly:{from:0,to:3,loop:!0,speed:8}}}),Zt.loadSprite("bears","./assets/game/bears.png",{sliceX:4,sliceY:4,anims:{"idle-side":0,"walk-side":{from:0,to:3,loop:!0,speed:8},jump:14}}),Zt.loadSprite("ice-map","./assets/game/ice-caps-map.png"),Zt.loadSound("forestSound","./assets/audios/map5.mp3"),Zt.loadSound("desertSound","./assets/audios/map4.mp3"),Zt.loadSound("iceSound","./assets/audios/map3.mp3"),Zt.loadSound("catSound","./assets/audios/map2.mp3"),Zt.loadSound("parkingSound","./assets/audios/map1.mp3"),Zt.loadSound("schoolSound","./assets/audios/school.mp3"),Zt.loadSound("victory","./assets/audios/win.mp3"),Zt.loadSound("gameover","./assets/audios/gameover.mp3"),Ft.setBackground(Ft.Color.fromHex("#311047")),Ft.scene("main",(async()=>{const e=(await(await fetch("./assets/game/map.json")).json()).layers,t=Ft.add([Ft.sprite("map"),Ft.pos(0),Ft.scale(4)]),i=Ft.make([Ft.sprite("birds",{anim:"fly"}),Ft.area({shape:new Ft.Rect(Ft.vec2(0,3),10,10)}),Ft.body(),Ft.anchor("center"),Ft.pos(),Ft.scale(1.5),{speed:250,isInDialogue:!1},"player"]);for(const n of e)if("boundaries"!==n.name){if("spawnpoints"===n.name)for(const e of n.objects)"player"!==e.name||(i.pos=Ft.vec2(4*(t.pos.x+e.x),4*(t.pos.y+e.y)),Ft.add(i))}else for(const e of n.objects)t.add([Ft.area({shape:new Ft.Rect(Ft.vec2(0),e.width,e.height)}),Ft.body({isStatic:!0}),Ft.pos(e.x,e.y),e.name]),e.name&&i.onCollide(e.name,(()=>{i.isInDialogue=!0,Xt(Ut[e.name],(()=>{i.isInDialogue=!1}))}));Wt(Ft),Ft.onResize((()=>{Wt(Ft)})),Ft.onUpdate((()=>{Ft.camPos(i.pos.x,i.pos.y+100)})),Ft.onMouseDown((e=>{if("left"!==e||i.isInDialogue)return;const t=Ft.toWorld(Ft.mousePos());i.moveTo(t,i.speed);const n=i.pos.angle(t);return Math.abs(n)>90?(i.flipX=!1,void(i.direction="right")):Math.abs(n)<90?(i.flipX=!0,void(i.direction="left")):void 0})),Ft.onKeyDown((e=>{const t=[Ft.isKeyDown("right"),Ft.isKeyDown("left"),Ft.isKeyDown("up"),Ft.isKeyDown("down")];let n=0;for(const i of t)i&&n++;if(!(n>1||i.isInDialogue))return t[0]?(i.flipX=!1,i.direction="right",void i.move(i.speed,0)):t[1]?(i.flipX=!0,i.direction="left",void i.move(-i.speed,0)):t[2]?(i.direction="up",void i.move(0,-i.speed)):void(t[3]&&(i.direction="down",i.move(0,i.speed)))}))})),Ft.scene("cat",(async({hasConversation:e})=>{const t=Ft.play("catSound",{volume:.2,loop:!0});Ft.setGravity(2e3);const i=await(await fetch("./assets/game/cat-level-map.json")).json(),n=i.layers,s=Ft.add([Ft.sprite("cat-map"),Ft.pos(0),Ft.scale(2)]),r=Ft.make([Ft.sprite("cats",{anim:"idle-up"}),Ft.area({shape:new Ft.Rect(Ft.vec2(0,3),10,10)}),Ft.body(),Ft.anchor("center"),Ft.pos(),Ft.scale(2),{speed:350,direction:"up",isInDialogue:!!e},"player"]);for(const a of n)if("boundaries"!==a.name){if("spawnpoint"===a.name)for(const e of a.objects)"player"!==e.name||(r.pos=Ft.vec2(4*(s.pos.x+e.x)/2,4*(s.pos.y+e.y)/2),Ft.add(r))}else for(const e of a.objects)s.add([Ft.area({shape:new Ft.Rect(Ft.vec2(0),e.width,e.height)}),Ft.body({isStatic:!0}),Ft.pos(e.x,e.y),e.name]),e.name&&("portal"===e.name&&r.onCollide("portal",(()=>{t.stop(),Ft.go("transition",{conversation:jt,nextScene:"forest"})})),r.onBeforePhysicsResolve((t=>{t.target.is(e.name)&&r.isJumping()&&t.preventResolution()})));Wt(Ft),Ft.onResize((()=>{Wt(Ft)})),Ft.onUpdate((()=>{Ft.camPos(r.pos.x,r.pos.y)})),Ft.onKeyDown((e=>{const t=[Ft.isKeyDown("right"),Ft.isKeyDown("left"),Ft.isKeyDown("up"),Ft.isKeyDown("space")];let i=0;for(const n of t)n&&i++;if(!(i>1||r.isInDialogue))return t[0]?(r.flipX=!1,"walk-side"!==r.curAnim()&&r.play("walk-side"),r.direction="right",void r.move(r.speed,0)):t[1]?(r.flipX=!0,"walk-side"!==r.curAnim()&&r.play("walk-side"),r.direction="left",void r.move(-r.speed,0)):t[2]?("walk-up"!==r.curAnim()&&r.play("walk-up"),void(r.direction="up")):void(t[3]&&r.isGrounded()&&("jump"!==r.curAnim()&&r.play("jump"),r.direction="up",r.jump(1100)))})),Ft.onKeyRelease((function(){"up"!==r.direction?r.play("idle-side"):r.play("idle-up")}));const o=Ft.add([Ft.sprite("water"),Ft.area({shape:new Ft.Rect(Ft.vec2(0,0),i.height*i.tileheight,i.width*i.tilewidth)}),Ft.anchor("topleft"),Ft.pos(0,i.height*i.tileheight*2),Ft.scale(6),{speed:25},"water"]);e?Jt(Kt,(()=>{r.isInDialogue=!1,Ft.loop(.25,(()=>{o.pos.y=o.pos.y-o.speed}))})):Ft.loop(.25,(()=>{o.pos.y=o.pos.y-o.speed})),r.onCollide("water",(()=>{Ft.go("lose",{backTo:"cat"})}))})),Ft.scene("classroom",(async({isFinalScene:e})=>{const t=Ft.play("schoolSound",{volume:.2,loop:!0}),i=(await(await fetch("./assets/game/classroom.json")).json()).layers,n=Ft.add([Ft.sprite("classroom-map"),Ft.pos(0),Ft.scale(4/6)]),s=Ft.make([Ft.area({shape:new Ft.Rect(Ft.vec2(0,3),10,10)}),Ft.body(),Ft.anchor("center"),Ft.pos(),Ft.scale(4/6),"player"]);for(const r of i)if("spawnpoint"===r.name)for(const e of r.objects)"player"!==e.name||(s.pos=Ft.vec2(4*(n.pos.x+e.x)/6,4*(n.pos.y+e.y)/6),Ft.add(s));Ft.wait(3,(()=>{e?Jt(Qt,(()=>{window.location.href="/public/quiz"})):Jt(Lt,(()=>{t.stop(),Ft.go("parking",{hasConversation:!0})}))})),Wt(Ft),Ft.onResize((()=>{Wt(Ft)})),Ft.onUpdate((()=>{Ft.camPos(s.pos.x,s.pos.y-100)}))})),Ft.scene("desert",(async({hasConversation:e})=>{const t=Ft.play("desertSound",{volume:.2,loop:!0}),i=(await(await fetch("./assets/game/desert-map.json")).json()).layers,n=Ft.add([Ft.sprite("desert-map"),Ft.pos(0),Ft.scale(1)]),s=Ft.make([Ft.sprite("foxes",{anim:"idle-side"}),Ft.area({shape:new Ft.Rect(Ft.vec2(0,3),10,10)}),Ft.body(),Ft.anchor("center"),Ft.pos(),Ft.scale(1),{speed:250,direction:"right",isInDialogue:!0},"player"]);Wt(Ft),Ft.onResize((()=>{Wt(Ft)})),Ft.onUpdate((()=>{Ft.camPos(s.pos.x,s.pos.y+100)}));for(const r of i)if("boundaries"!==r.name){if("spawnpoint"===r.name)for(const e of r.objects)"player"!==e.name||(s.pos=Ft.vec2(4*(n.pos.x+e.x)/4,4*(n.pos.y+e.y)/4),Ft.add(s))}else for(const e of r.objects)n.add([Ft.area({shape:new Ft.Rect(Ft.vec2(0),e.width,e.height)}),Ft.body({isStatic:!0}),Ft.pos(e.x,e.y),e.name]),e.name&&s.onCollide(e.name,(()=>{"final"===e.name?(t.stop(),Ft.go("transition",{conversation:zt,nextScene:"classroom"})):(s.isInDialogue=!0,Xt(Nt[e.name],(()=>{s.isInDialogue=!1})))}));e&&Jt(Yt,(()=>{s.isInDialogue=!1})),Ft.onKeyDown((e=>{const t=[Ft.isKeyDown("right"),Ft.isKeyDown("left"),Ft.isKeyDown("up"),Ft.isKeyDown("down")];let i=0;for(const n of t)n&&i++;if(!(i>1||s.isInDialogue))return t[0]?(s.flipX=!1,"walk-side"!==s.curAnim()&&s.play("walk-side"),s.direction="right",void s.move(s.speed,0)):t[1]?(s.flipX=!0,"walk-side"!==s.curAnim()&&s.play("walk-side"),s.direction="left",void s.move(-s.speed,0)):t[2]?(s.direction="up","walk-up"!==s.curAnim()&&s.play("walk-up"),void s.move(0,-s.speed)):void(t[3]&&(s.direction="down","walk-down"!==s.curAnim()&&s.play("walk-down"),s.move(0,s.speed)))})),Ft.onKeyRelease((function(){"down"!==s.direction?"up"!==s.direction?s.play("idle-side"):s.play("idle-up"):s.play("idle-down")}))})),Ft.scene("parking",(async()=>{const e=Ft.play("parkingSound",{volume:.2,loop:!0}),t=(await(await fetch("./assets/game/parking.json")).json()).layers,i=Ft.add([Ft.sprite("parking"),Ft.pos(0),Ft.scale(1.6)]),n=Ft.make([Ft.sprite("cats",{anim:"idle-up"}),Ft.area({shape:new Ft.Rect(Ft.vec2(0,3),10,10)}),Ft.body(),Ft.anchor("center"),Ft.pos(),Ft.scale(1.6),{speed:350,direction:"up",isInDialogue:!0},"player"]);for(const s of t)if("boundaries"!==s.name){if("spawnpoint"===s.name)for(const e of s.objects)"player"!==e.name||(n.pos=Ft.vec2(4*(i.pos.x+e.x)/2.5,4*(i.pos.y+e.y)/2.5),Ft.add(n))}else for(const t of s.objects)i.add([Ft.area({shape:new Ft.Rect(Ft.vec2(0),t.width,t.height)}),Ft.body({isStatic:!0}),Ft.pos(t.x,t.y),t.name]),t.name&&n.onCollide(t.name,(()=>{n.isInDialogue=!0,Xt(Nt[t.name],(()=>{n.isInDialogue=!1,"loss"===t.name&&(e.stop(),Ft.go("cat",{hasConversation:!0}))}))}));Wt(Ft),Ft.onResize((()=>{Wt(Ft)})),Ft.onUpdate((()=>{Ft.camPos(n.pos.x,n.pos.y)})),Jt(qt,(()=>{n.isInDialogue=!1})),Ft.onKeyDown((e=>{const t=[Ft.isKeyDown("right"),Ft.isKeyDown("left"),Ft.isKeyDown("up"),Ft.isKeyDown("down")];let i=0;for(const n of t)n&&i++;if(!(i>1||n.isInDialogue))return t[0]?(n.flipX=!1,"walk-side"!==n.curAnim()&&n.play("walk-side"),n.direction="right",void n.move(n.speed,0)):t[1]?(n.flipX=!0,"walk-side"!==n.curAnim()&&n.play("walk-side"),n.direction="left",void n.move(-n.speed,0)):t[2]?("walk-up"!==n.curAnim()&&n.play("walk-up"),n.direction="up",void n.move(0,-n.speed)):void(t[3]&&("walk-down"!==n.curAnim()&&n.play("walk-down"),n.direction="down",n.move(0,n.speed)))})),Ft.onKeyRelease((function(){"down"!==n.direction?"up"!==n.direction?n.play("idle-side"):n.play("idle-up"):n.play("idle-down")}))})),Ft.scene("forest",(async({hasConversation:e})=>{Ft.setGravity(0);const t=Ft.play("forestSound",{volume:.2,loop:!0}),i=(await(await fetch("./assets/game/maze-of-trees.json")).json()).layers,n=Ft.add([Ft.sprite("forest"),Ft.pos(0),Ft.scale(2)]),s=Ft.make([Ft.sprite("birds",{anim:"fly"}),Ft.area({shape:new Ft.Rect(Ft.vec2(0,3),10,10)}),Ft.body(),Ft.anchor("center"),Ft.pos(),Ft.scale(2),{speed:450,direction:"right",isInDialogue:!!e},"player"]);Wt(Ft),Ft.onResize((()=>{Wt(Ft)})),Ft.onUpdate((()=>{Ft.camPos(s.pos.x,s.pos.y+100)}));for(const r of i)if("boundaries"!==r.name){if("spawnpoint"===r.name)for(const e of r.objects)if("player"!==e.name){if("tree"===e.name&&Ft.rand()>.5)if(1===Ft.randi(1,3)){const t=Ft.make([Ft.sprite("trees",{anim:"tree-1"}),Ft.anchor("bot"),Ft.pos(4*(n.pos.x+e.x)/2,4*(n.pos.y+e.y)/2),Ft.scale(1.6)]);Ft.add(t)}else{const t=Ft.make([Ft.sprite("trees",{anim:"tree-2"}),Ft.anchor("bot"),Ft.pos(4*(n.pos.x+e.x)/2,4*(n.pos.y+e.y)/2),Ft.scale(1.6)]);Ft.add(t)}}else s.pos=Ft.vec2(4*(n.pos.x+e.x)/2,4*(n.pos.y+e.y)/2),Ft.add(s)}else for(const e of r.objects)n.add([Ft.area({shape:new Ft.Rect(Ft.vec2(0),e.width,e.height)}),Ft.body({isStatic:!0}),Ft.pos(e.x,e.y),e.name]),e.name?s.onCollide(e.name,(()=>{"final"===e.name?(t.stop(),Ft.go("desert",{hasConversation:!0})):(s.isInDialogue=!0,Xt(Nt[e.name],(()=>{s.isInDialogue=!1})))})):s.onCollide("",(()=>{Ft.go("lose",{backTo:"forest"})}));e&&Jt(Ht,(()=>{s.isInDialogue=!1})),Ft.onKeyDown((e=>{const t=[Ft.isKeyDown("right"),Ft.isKeyDown("left"),Ft.isKeyDown("up"),Ft.isKeyDown("down")];let i=0;for(const n of t)n&&i++;if(!(i>1||s.isInDialogue))return t[0]?(s.flipX=!1,s.direction="right",void s.move(s.speed,0)):t[1]?(s.flipX=!0,s.direction="left",void s.move(-s.speed,0)):t[2]?(s.direction="up",void s.move(0,-s.speed)):void(t[3]&&(s.direction="down",s.move(0,s.speed)))}))})),Ft.scene("ice",(async({hasConversation:e})=>{const t=Ft.play("iceSound",{volume:.2,loop:!0}),i=(await(await fetch("./assets/game/ice-caps-map.json")).json()).layers,n=Ft.add([Ft.sprite("ice-map"),Ft.pos(0),Ft.scale(2)]),s=Ft.make([Ft.sprite("bears",{anim:"idle-side"}),Ft.area({shape:new Ft.Rect(Ft.vec2(0,3),10,10)}),Ft.body({jumpForce:1e3}),Ft.anchor("center"),Ft.pos(),Ft.scale(2),{speed:450,direction:"right",isInDialogue:!0},"player"]);Wt(Ft),Ft.onResize((()=>{Wt(Ft)})),Ft.onUpdate((()=>{Ft.camPos(s.pos.x,s.pos.y+100)}));for(const r of i)if("boundaries"!==r.name){if("spawnpoint"===r.name)for(const e of r.objects)"player"!==e.name||(s.pos=Ft.vec2(4*(n.pos.x+e.x)/2,4*(n.pos.y+e.y)/2),Ft.add(s))}else for(const e of r.objects)n.add([Ft.area({shape:new Ft.Rect(Ft.vec2(0),e.width,e.height)}),Ft.body({isStatic:!0}),Ft.pos(e.x,e.y),e.name]),e.name?s.onCollide(e.name,(()=>{s.isInDialogue=!0,Xt(Nt[e.name],(()=>{s.isInDialogue=!1})),t.stop(),Ft.go("transition",{conversation:Gt,nextScene:"parking"})})):s.onCollide("water",(()=>{Ft.go("lose",{backTo:"ice"})}));e&&Jt(Ot,(()=>{s.isInDialogue=!1})),Ft.onKeyDown((e=>{const t=[Ft.isKeyDown("right"),Ft.isKeyDown("left"),Ft.isKeyDown("up"),Ft.isKeyDown("down"),Ft.isKeyDown("space")];let i=0;for(const n of t)n&&i++;if(!(i>1||s.isInDialogue)){if(t[0])return s.flipX=!1,"walk-side"!==s.curAnim()&&s.play("walk-side"),s.direction="right",void s.move(s.speed,0);if(t[1])return s.flipX=!0,"walk-side"!==s.curAnim()&&s.play("walk-side"),s.direction="left",void s.move(-s.speed,0);if(t[2])return s.direction="up","walk-side"!==s.curAnim()&&s.play("walk-side"),void s.move(0,-s.speed);t[3]&&("walk-side"!==s.curAnim()&&s.play("walk-side"),s.direction="down",s.move(0,s.speed)),t[4]&&("jump"!==s.curAnim()&&s.play("jump"),s.direction="up",jump(s))}})),Ft.onKeyRelease((function(){s.play("idle-side")}))})),Ft.scene("transition",(async({conversation:e,nextScene:t})=>{const i=Ft.play("victory",{volume:.2,loop:!1});Jt(e,"classroom"===t?()=>{Ft.go(t,{isFinalScene:!0})}:()=>{i.stop(),Ft.go(t,{hasConversation:!0})})})),Ft.scene("lose",(async({backTo:e})=>{Ft.play("gameover",{volume:.2,loop:!1}),Ft.add([Ft.text("You lose!"),Ft.pos(Ft.width()/2,Ft.height()/2-58),Ft.scale(2),Ft.anchor("center")]),Ft.add([Ft.text("Looks like the Climate Crisis' efects are not so easy to ignore, huh?"),Ft.pos(Ft.width()/2,Ft.height()/2+58),Ft.scale(.75),Ft.anchor("center")]),Ft.add([Ft.text("Press SPACE to play again."),Ft.pos(Ft.width()/2,Ft.height()/2+138),Ft.scale(1),Ft.anchor("center")]),Ft.onKeyPress("space",(()=>{Ft.go(e,{hasConversation:!1})}))})),Ft.go("classroom",{isFinalScene:!1});
